<!DOCTYPE html>
<html lang="en">
<head>
		<title>as days pass by &mdash; OwnTracks and a map</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<link rel="profile" href="http://gmpg.org/xfn/11" />
		<link href="https://fonts.googleapis.com/css?family=Covered+By+Your+Grace|Maitree" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="//www.kryogenix.org/days/theme/css/style.css" />
		<link rel="stylesheet" type="text/css" href="//www.kryogenix.org/days/theme/css/simple-footnotes.css" />
		<link rel="icon" type="image/png" href="/favicon.png" />
		<style type="text/css">
			body.custom-background {
				background: url(//www.kryogenix.org/days/theme/handmadepaper.png); /* thank you subtlepatterns! */
			}
		</style>
		<link rel="alternate" type="application/rss+xml"
			title="as days pass by"
			href="//www.kryogenix.org/days/feed" /> 
		<!--[if lte IE 8]><script src="//www.kryogenix.org/days/theme/js/html5shiv.js"></script><![endif]-->
		<link rel="webmention" href="https://webmention.herokuapp.com/api/webmention" />
		<link rel="feed" href="http://www.kryogenix.org/days/archives/"> 
		<script src="https://cdn.ravenjs.com/3.4.1/raven.min.js"></script>
		<script>Raven.config('https://fc8cd4c9637043f3b385d9daa8dbe367@app.getsentry.com/91852').install()</script>
</head>

<body class="home blog custom-background single-author" >
	<div id="container">
		<div id="header">
				<p>A blog by <a href="//www.kryogenix.org/">Stuart Langridge</a></p>
				<h1 id="site-title"><a href="//www.kryogenix.org/days">as days pass by</a></h1>
<h2 id="site-description">scratched tallies on the prison wall</h2>		</div><!-- /#banner -->
		
		<div id="menu">
			<div class="menu-navigation-container">
				<ul id="menu-navigation" class="menu">
						<li  class="active" class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/">Kryogenix Consulting</a></li>
						<li  class="active" class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/days/archives">All posts, ever</a></li>
						<li  class="active" class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/code">Code</a></li>

				</ul>
			</div> <!--/#menu-navigation-container-->
		</div><!-- /#menu -->
		
		<div class="page-title">
		</div>
	
		<div id="contents">

<div class="post type-post status-publish format-standard hentry category-general h-entry" id="post">
	<div class="entry-meta">
		<div class="date"><a href="//www.kryogenix.org/days/2017/12/28/owntracks-and-a-map/"><time 
			class="dt-published" datetime="2017-12-28T11:33:00">Dec 28 2017</time></a>
			<span class="byline h-card">By <a class="p-author" href="//www.kryogenix.org/days/"><img src="https://kryogenix.org/images/hackergotchi-simpler.png" class="u-photo" alt=""> <span class="p-name">sil</span></a></span>
		</div>
	</div> <!-- /#entry-meta -->
	<div class="main">
		<h2 class="entry-title">
			<a class="u-url p-name" href="//www.kryogenix.org/days/2017/12/28/owntracks-and-a-map/" title="Permalink to OwnTracks and a map" rel="bookmark">OwnTracks and a&nbsp;map</a>
		</h2>
		<div class="entry-content e-content">
			<p>Every year we do a bit of a pub crawl in Birmingham between Christmas and New Year; a chance to get away from the turkey risotto, and hang out with people and talk about techie things after a few days away with family and so on. It’s all rather loosely organised — I tried putting exact times on every pub once and it didn’t work out very well. So this year, 2017, I wanted a map which showed where we were so people can come and find us — it’s a twelve-hour all-day-and-evening thing but nobody does the whole thing<sup id="sf-owntracks-and-a-map-1-back"><a title="well, except me. And hero of the revolution Andy Yates." class="simple-footnote" href="#sf-owntracks-and-a-map-1">1</a></sup> so the idea is that you can drop in at some point, have a couple of drinks, and then head off again. For that, you need to know where we all are.</p>
<p>Clearly, the solution here is technology; I carry a device in my pocket<sup id="sf-owntracks-and-a-map-2-back"><a title="and you do too" class="simple-footnote" href="#sf-owntracks-and-a-map-2">2</a></sup> which knows where I am and can display that on a map. There are a few services that do this, or used to — Google Latitude, <span class="caps">FB</span> messenger does it, Apple find-my-friends — but they’re all “only people with the Magic Software can see this”, and “you have to use our servers”, and that’s not very web-ish, is it? What I wanted was a thing which sat there in the background on my phone and reported my location to <em>my</em> server when I moved around, and didn’t eat battery. That wouldn’t be tricky to write but I bet there’s a load of annoying corner cases, which is why I was very glad to discover that <a href="http://owntracks.org/">OwnTracks</a> have done it for me.</p>
<p>You install their mobile app (for Android or iOS) and then configure it with the <span class="caps">URL</span> of your server and every now and again it reports your location by posting <span class="caps">JSON</span> to that <span class="caps">URL</span> saying what your location is. Only one word for that: magic darts. Exactly what I wanted.</p>
<p>It’s a little tricky because of that “don’t use lots of battery” requirement. Apple heavily restrict background location sniffing, for lots of good reasons. If your app is the active app and the screen’s unlocked, it can read your location as often as it wants, but that’s impractical. If you want to get notified of location changes in the <em>background</em> on iOS then you only get told if you’ve moved more than 500 metres in less than five minutes<sup id="sf-owntracks-and-a-map-3-back"><a title="the OwnTracks docs explain this in more detail" class="simple-footnote" href="#sf-owntracks-and-a-map-3">3</a></sup> which is fine if you’re on the motorway but less fine if you’re walking around town and won’t move that far. However, you can nominate certain locations as “waypoints” and then the app gets notified whenever it enters or leaves a waypoint, even if it’s in the background and set to “manual mode”. So, I added all the pubs we’re planning on going to as waypoints, which is a bit annoying to do manually but works fine.</p>
<p>OwnTracks then posts my location to a tiny <span class="caps">PHP</span> file which just dumps it in a big <span class="caps">JSON</span> list. The <a href="https://kryogenix.org/brumtechxmas17/">#brumtechxmas 2017 map</a> then reads that <span class="caps">JSON</span> file and plots the walk on the map (or it will do once we’re doing it; as I write this, the event isn’t until tomorrow, Friday 29th December, but I have tested it out).</p>
<p>The map is an <span class="caps">SVG</span>, embedded in the page. This has the nice property that I can change it with <span class="caps">CSS</span>. In particular, the page looks at the list of locations we’ve been in and works out whether any of them were close enough to a pub on the map that we probably went in there… and then uses <span class="caps">CSS</span> to colour the pub we’re <em>in</em> green, and ones we’ve been in grey. So it’s dynamic! Nice and easy to find us wherever we are. If it works, which is a bit handwavy at this point.</p>
<p>If you’re coming, see you tomorrow. If you’re not coming: you should come. :-)</p>
<p><img src="/images/brumtechxmas2017.png" title="A static version of the map: you'll want the website for the real dynamic clever one" alt="A static version of the map: you'll want the website for the real dynamic clever one"></p><ol class="simple-footnotes"><li id="sf-owntracks-and-a-map-1">well, except me. And hero of the revolution Andy Yates. <a class="simple-footnote-back" href="#sf-owntracks-and-a-map-1-back">↩</a></li><li id="sf-owntracks-and-a-map-2">and you do too <a class="simple-footnote-back" href="#sf-owntracks-and-a-map-2-back">↩</a></li><li id="sf-owntracks-and-a-map-3">the <a href="http://owntracks.org/booklet/features/location/#ios">OwnTracks docs</a> explain this in more detail <a class="simple-footnote-back" href="#sf-owntracks-and-a-map-3-back">↩</a></li></ol>
		</div> <!--/#entry-content-->
		<ul class="neighbours-links">
		<li><a href="//www.kryogenix.org/days/2017/11/12/i-wrote-a-web-component/">Previous post</a></li>
		<li><a href="//www.kryogenix.org/days/2018/01/06/happy-anniversary/">Next post</a></li>
		</ul>
	</div> <!--/#main-->
</div>  <!--/#post-->
<div id="webmentions">
<h4>More in the discussion (powered by <a href="http://indiewebcamp.com/Webmention">webmentions</a>)</h4>
	<ul>
		<li><img src="https://pbs.twimg.com/profile_images/520210109842993152/PE7Uo7Yc.jpeg">
			Jumptwenty4 responded at
		<a href="https://twitter.com/jumptwenty4/status/946353751614517248">twitter.com</a>
		<span class="wm-summary">			those of you interested in how the magic dynamic map works may find kryogenix.org/days/2017/12/2… interesting -- the short answer is @OwnTracks pl
</span></li>
		<li><img src="https://pbs.twimg.com/profile_images/891094279564607488/56dDc7Vq.jpg">
			Mike Elsmore responded at
		<a href="https://twitter.com/ukmadlz/status/946353885995814912">twitter.com</a>
		<span class="wm-summary">			Nice write up by @sil on how he's automated tomorrows #brumtechxmas map kryogenix.org/days/2017/12/2…
</span></li>
		<li><img src="https://pbs.twimg.com/profile_images/2627489858/fe7hm2ounpuu2qfe5akj.jpeg">
			Andrew Yates responded at
		<a href="https://twitter.com/ay8s/status/946356661438083072">twitter.com</a>
		<span class="wm-summary">			those of you interested in how the magic dynamic map works may find kryogenix.org/days/2017/12/2… interesting -- the short answer is @OwnTracks pl
</span></li>
		<li><img src="https://pbs.twimg.com/profile_images/1315700871/nick_cropped.png">
			Nick Morrott responded at
		<a href="https://twitter.com/sil/status/946349784251731968#favorited-by-283892690">...</a>
(twitter.com)		<span class="wm-summary"></span></li>
	</ul>
<form id="wmform" method="POST" action="https://webmention.herokuapp.com/api/webmention">
	<label>Did you link to this post? Enter your page's URL:
	<input type="url" name="source"></label>
	<input type="hidden" name="target" value="http://www.kryogenix.org/days/2017/12/28/owntracks-and-a-map/">
	<input type="submit" value="Add link">
</form>
<script src="//www.kryogenix.org/days/theme/live-webmentions-cors.js"></script>
</div>

<p id="oldcomments"></p>
<script>
var aurl = '2017/12/28/owntracks-and-a-map/';
var parts = aurl.split('/');
if (parts[parts.length-1] === "") { parts = parts.slice(0, parts.length-1); }
var tooNewForOldComments = false;
if (parts[0].match(/^[0-9]+$/)) {
	var asnum = parseInt(parts[0], 10);
	if (!isNaN(asnum) && asnum > 2014) {
		tooNewForOldComments = true;
	}
}
if (!tooNewForOldComments) {
	var comurl = "/oldcomments/" + parts.join("-") + ".html";
	var x = new XMLHttpRequest();
	x.open("HEAD", comurl, true);
	x.onreadystatechange = function() {
		if (x.readyState == 4) {
			if (x.status == 200) {
				document.getElementById("oldcomments").innerHTML = '<a href="' + comurl + '">See pre-2014 comments on this post</a>';
			}
		}
	};
	x.send();
}
</script>

		</div>
		
		<div id="footer">
			<p>Powered by <a href="http://pelican.readthedocs.org">Pelican</a>, theme by <a href="http://bunnyman.info">tBunnyMan</a>.</p>
				<script type="text/javascript">
					var _gaq = _gaq || [];
					_gaq.push(['_setAccount', 'UA-331575-1']);
					_gaq.push(['_trackPageview']);
					(function() {
						var ga = document.createElement('script'); 
						ga.type = 'text/javascript'; ga.async = true;
						ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
						var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
					})();
				</script>
		</div><!-- /#footer -->
	</div><!-- /#container -->
	<div style="display:none"></div>
</body>
</html>