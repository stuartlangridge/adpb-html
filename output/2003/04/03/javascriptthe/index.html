<!DOCTYPE html>
<html lang="en">
<head>
		<title>as days pass by &mdash; The Q tag and JavaScript</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<link rel="profile" href="http://gmpg.org/xfn/11" />
		<link rel="stylesheet" type="text/css" href="//www.kryogenix.org/days/theme/css/style.css" />
		<link rel="stylesheet" id="oswald-css" href="https://fonts.googleapis.com/css?family=Oswald&#038;ver=3.3.2" type="text/css" media="all">
		<link href="https://fonts.googleapis.com/css?family=Raleway:400,700,700italic,400italic&amp;subset=latin,latin-ext" rel="stylesheet" type="text/css">
		<link rel="stylesheet" type="text/css" href="//www.kryogenix.org/days/theme/css/simple-footnotes.css" />
		<link rel="icon" type="image/png" href="/favicon.png" />
		<style type="text/css">
			body.custom-background { background-color: #f5f5f5; }
		</style>
		<link rel="alternate" type="application/rss+xml"
			title="as days pass by"
			href="//www.kryogenix.org/days/feed" /> 
		<!--[if lte IE 8]><script src="//www.kryogenix.org/days/theme/js/html5shiv.js"></script><![endif]-->
		<link rel="webmention" href="https://webmention.herokuapp.com/api/webmention" />
		<link rel="feed" href="http://www.kryogenix.org/days/archives/"> 
		<script src="https://cdn.ravenjs.com/3.4.1/raven.min.js"></script>
		<script>Raven.config('https://fc8cd4c9637043f3b385d9daa8dbe367@app.getsentry.com/91852').install()</script>
</head>

<body class="home blog custom-background single-author" >
	<div id="container">
		<div id="header">
				<p>A blog by <a href="//www.kryogenix.org/">Stuart Langridge</a></p>
				<h1 id="site-title"><a href="//www.kryogenix.org/days">as days pass by</a></h1>
<h2 id="site-description">scratched tallies on the prison wall</h2>		</div><!-- /#banner -->
		
		<div id="menu">
			<div class="menu-navigation-container">
				<ul id="menu-navigation" class="menu">
						<li  class="active" class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/">Kryogenix Consulting</a></li>
						<li  class="active" class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/days/archives">All posts, ever</a></li>
						<li  class="active" class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/code">Code</a></li>

				</ul>
			</div> <!--/#menu-navigation-container-->
		</div><!-- /#menu -->
		
		<div class="page-title">
		</div>
	
		<div id="contents">

<div class="post type-post status-publish format-standard hentry category-general h-entry" id="post">
	<div class="entry-meta">
		<div class="date"><a href="//www.kryogenix.org/days/2003/04/03/javascriptthe/"><time 
			class="dt-published" datetime="2003-04-03T11:00:00">Apr 03 2003</time></a>
			<span class="byline h-card">By <a class="p-author" href="//www.kryogenix.org/days/"><img src="http://kryogenix.org/images/hackergotchi-simpler.png" class="u-photo" alt=""> <span class="p-name">sil</span></a></span>
		</div>
	</div> <!-- /#entry-meta -->
	<div class="main">
		<h2 class="entry-title">
			<a class="u-url p-name" href="//www.kryogenix.org/days/2003/04/03/javascriptthe/" title="Permalink to The Q tag and JavaScript" rel="bookmark">The Q tag and&nbsp;JavaScript</a>
		</h2>
		<div class="entry-content e-content">
			<!--timestamp:1049396151.0:-->

<!--category::-->

<!--author:sil:-->

<p>Simon has put together <a href="http://simon.incutio.com/archive/2003/04/03/fixingQuotesWithJavascript">a semi-solution</a> for <span class="caps">IE</span>&#8217;s failure to obey the
<span class="caps">CSS</span> <code>quotes</code> declaration. He goes on to note a couple of problems with
his&nbsp;solution:</p>
<blockquote>
<p>There are two main disadvantages to this solution: It introduces an
invalid property to your <span class="caps">CSS</span>, and it could result in duplicated quotes
in <span class="caps">IE</span> 7 should that browser finally fix the lack of quote element&nbsp;support.</p>
</blockquote>
<p>Both of these are, I think, soluble. Obviously, the first, invalid <span class="caps">CSS</span>,
would be simply solved by not using <span class="caps">MS</span>-proprietary <span class="caps">IE</span> <span class="caps">DHTML</span> behaviours.
You know it makes&nbsp;sense.</p>
<p>The second is a little more complex and requires a bit of guesswork on
my part. It is possible in both Mozilla and <span class="caps">IE</span> to (at least
theoretically) get the <em>computed style</em> for an element from JavaScript.
This computed style dictates how the element is actually being
displayed, covering all style declarations that apply to it (from
external and internal stylesheets, inline style, and JavaScript
changes); the more familiar <code>element.style</code> collection only covers the
latter two. Moz does it the standards-compliant way, using
<code>document.defaultView.getComputedStyle(element,'')</code> to get the computed
style for <code>element</code>, but it&#8217;s somewhat ropey in terms of how well it
actually works. <span class="caps">IE</span> uses a proprietary <code>element.currentStyle</code> collection.
So, using one of these, we can see the full computed style for the
element. Now (and this is where the guesswork bit comes into play), I
have assumed that <span class="caps">IE</span>&#8217;s complete lack of support means that it will not
include <code>quotes</code> in the computed style of an object, even if a <code>quotes</code>
attribute is applied in the <span class="caps">CSS</span>, and indeed this does turn out to be so.
I&#8217;ve also assumed that, should <span class="caps">IE7</span> change to support this <span class="caps">CSS</span>
declaration, they&#8217;ll make its value settable from JavaScript, which
would mean adding it to <code>currentStyle</code> for an element. So, if we get the
computed style for an element with <code>quotes</code> applied, and it <em>does</em>
reflect your application of the <code>quotes</code> directive, we assume that the
browser handles it and leave it alone. If, however, you apply <code>quotes</code>
to an element and that application is <em>not</em> reflected in the computed
style, we assume that the browser doesn&#8217;t understand it, and we can then
go on to manually apply quotes as Simon&#8217;s code&nbsp;does.</p>
<p>How do we check for <code>quotes</code> showing up in the computed style? Like&nbsp;so:</p>
<div class="highlight"><pre><span class="n">quotesElements</span> <span class="o">=</span> <span class="n">document</span><span class="p">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s">&quot;q&quot;</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">quotesElements</span><span class="p">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">q</span><span class="o">=</span><span class="n">quotesElements</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">currentStyle</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">currentStyle</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">document</span><span class="p">.</span><span class="n">defaultView</span> <span class="o">&amp;&amp;</span>
<span class="n">document</span><span class="p">.</span><span class="n">defaultView</span><span class="p">.</span><span class="n">getComputedStyle</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">document</span><span class="p">.</span><span class="n">defaultView</span><span class="p">.</span><span class="n">getComputedStyle</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="err">&#39;&#39;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">supportsQuotes</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">prop</span> <span class="n">in</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">prop</span><span class="p">.</span><span class="n">toLowerCase</span><span class="p">()</span> <span class="o">==</span> <span class="err">&#39;</span><span class="n">quotes</span><span class="err">&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">supportsQuotes</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">supportsQuotes</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">alert</span><span class="p">(</span><span class="s">&quot;Supports quotes declaration&quot;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">alert</span><span class="p">(</span><span class="s">&quot;Does not support quotes declaration&quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>This code checks for a <code>quotes</code> declaration in the computed style of
your first \&lt;Q> element.</p>
		</div> <!--/#entry-content-->
		<ul class="neighbours-links">
		<li><a href="//www.kryogenix.org/days/2003/04/02/javascriptpower/">Previous post</a></li>
		<li><a href="//www.kryogenix.org/days/2003/04/04/antipixel/">Next post</a></li>
		</ul>
	</div> <!--/#main-->
</div>  <!--/#post-->
<div id="webmentions">
<h4>More in the discussion (powered by <a href="http://indiewebcamp.com/Webmention">webmentions</a>)</h4>
	<ul><li>(no mentions, yet.)</li></ul>
<form id="wmform" method="POST" action="https://webmention.herokuapp.com/api/webmention">
	<label>Did you link to this post? Enter your page's URL:
	<input type="url" name="source"></label>
	<input type="hidden" name="target" value="http://www.kryogenix.org/days/2003/04/03/javascriptthe/">
	<input type="submit" value="Add link">
</form>
<script src="//www.kryogenix.org/days/theme/live-webmentions-cors.js"></script>
</div>

<p id="oldcomments"></p>
<script>
var aurl = '2003/04/03/javascriptthe/';
var parts = aurl.split('/');
if (parts[parts.length-1] === "") { parts = parts.slice(0, parts.length-1); }
var tooNewForOldComments = false;
if (parts[0].match(/^[0-9]+$/)) {
	var asnum = parseInt(parts[0], 10);
	if (!isNaN(asnum) && asnum > 2014) {
		tooNewForOldComments = true;
	}
}
if (!tooNewForOldComments) {
	var comurl = "/oldcomments/" + parts.join("-") + ".html";
	var x = new XMLHttpRequest();
	x.open("HEAD", comurl, true);
	x.onreadystatechange = function() {
		if (x.readyState == 4) {
			if (x.status == 200) {
				document.getElementById("oldcomments").innerHTML = '<a href="' + comurl + '">See pre-2014 comments on this post</a>';
			}
		}
	};
	x.send();
}
</script>

		</div>
		
		<div id="footer">
			<p>Powered by <a href="http://pelican.readthedocs.org">Pelican</a>, theme by <a href="http://bunnyman.info">tBunnyMan</a>.</p>
				<script type="text/javascript">
					var _gaq = _gaq || [];
					_gaq.push(['_setAccount', 'UA-331575-1']);
					_gaq.push(['_trackPageview']);
					(function() {
						var ga = document.createElement('script'); 
						ga.type = 'text/javascript'; ga.async = true;
						ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
						var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
					})();

					// from https://paul.kinlan.me/detecting-injected-content/
					var detectInjection = function(knownHostsArray) {
						if (!window.performance) return;
						var requests = window.performance.getEntriesByType("resource");
						var unknownHosts = []; var knownHosts = {}; var foundHosts = {};
						for (var knownHost in knownHostsArray) {
							knownHosts[knownHostsArray[knownHost]] = true;
						}
						for (var requestIdx = 0; requestIdx < requests.length; requestIdx++) {
							var request = requests[requestIdx];
							var url = new URL(request.name);
							var host = url.host;
							// Aggregate all the requests from a host
							if(host in foundHosts) { foundHosts[host].push(request); } else { foundHosts[host] = new Array(request); }
						}
						for(var foundHost in foundHosts) {
							// If an unknown host is found, add it to a list.
							if(!(foundHost in knownHosts)) { unknownHosts.push(foundHost); }
						}
						return unknownHosts;
					};
					window.addEventListener("load", function() {
						var scripts = detectInjection(["kryogenix.org", "www.kryogenix.org", "www.google-analytics.com"]);
						if(!!scripts === true && scripts.length > 0) {
							for(var scriptsIdx = 0; scriptsIdx < scripts.length; scriptsIdx++) {
								var scr = scripts[scriptsIdx];
								_gaq.push(['trackEvent', 'ScriptLoads', 'UnknownHost', scr]);
							}
						}
					});
				</script>
		</div><!-- /#footer -->
	</div><!-- /#container -->
	<div style="display:none"></div>
</body>
</html>