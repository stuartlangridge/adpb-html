<!DOCTYPE html>
<html lang="en">
<head>
		<title>as days pass by &mdash; Step away from the localStorage</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<link rel="profile" href="http://gmpg.org/xfn/11" />
		<link rel="stylesheet" type="text/css" href="http://www.kryogenix.org/days/theme/css/style.css" />
		<link rel='stylesheet' id='oswald-css'  href='http://fonts.googleapis.com/css?family=Oswald&#038;ver=3.3.2' type='text/css' media='all' />
		<link rel="stylesheet" type="text/css" href="http://www.kryogenix.org/days/theme/css/simple-footnotes.css" />
		<link rel="icon" type="image/png" href="/favicon.png" />
		<style type="text/css">
			body.custom-background { background-color: #f5f5f5; }
		</style>
		<link rel="alternate" type="application/rss+xml"
			title="as days pass by"
			href="http://www.kryogenix.org/days/feed" /> 
		<!--[if lte IE 8]><script src="http://www.kryogenix.org/days/theme/js/html5shiv.js"></script><![endif]-->
		<link rel="webmention" href="https://webmention.herokuapp.com/api/webmention" />
		<link rel="feed" href="http://www.kryogenix.org/days/archives/"> 
</head>

<body class="home blog custom-background single-author" >
	<div id="container">
		<div id="header">
				<p>A blog by <a href="http://www.kryogenix.org/">Stuart Langridge</a></p>
				<h1 id="site-title"><a href="http://www.kryogenix.org/days">as days pass by</a></h1>
<h2 id="site-description">scratched tallies on the prison wall</h2>		</div><!-- /#banner -->
		
		<div id="menu">
			<div class="menu-navigation-container">
				<ul id="menu-navigation" class="menu">
						<li  class="active" class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/">Kryogenix Consulting</a></li>
						<li  class="active" class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/days/archives">All posts, ever</a></li>
						<li  class="active" class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/code">Code</a></li>

				</ul>
			</div> <!--/#menu-navigation-container-->
		</div><!-- /#menu -->
		
		<div class="page-title">
		</div>
	
		<div id="contents">

<div class="post type-post status-publish format-standard hentry category-general h-entry" id="post">
	<div class="entry-meta">
		<div class="date"><a href="http://www.kryogenix.org/days/2012/03/20/step-away-from-the-localstorage/"><time 
			class="dt-published" datetime="2012-03-20T14:37:00">Mar 20 2012</time></a>
			<span class="byline h-card">By <a class="p-author" href="http://www.kryogenix.org/days/"><img src="http://kryogenix.org/images/hackergotchi-simpler.png" class="u-photo" alt=""> <span class="p-name">sil</span></a></span>
		</div>
	</div> <!-- /#entry-meta -->
	<div class="main">
		<h2 class="entry-title">
			<a class="u-url p-name" href="http://www.kryogenix.org/days/2012/03/20/step-away-from-the-localstorage/" title="Permalink to Step away from the localStorage" rel="bookmark">Step away from the&nbsp;localStorage</a>
		</h2>
		<div class="entry-content e-content">
			<p>There has been much discussion (<a href="http://hacks.mozilla.org/2012/03/there-is-no-simple-solution-for-local-storage/">example</a>, <a href="https://blog.mozilla.com/tglek/2012/02/22/psa-dom-local-storage-considered-harmful/">example</a>, <a href="http://webreflection.blogspot.co.uk/2012/03/whats-localstorage-about.html">example</a>,
<a href="http://paul.kinlan.me/we-need-to-kill-off-the-localstorage-api/">example</a>) recently about how the <a href="https://developer.mozilla.org/en/DOM/Storage">in-browser localStorage <span class="caps">API</span></a> is
terrible and must be killed with&nbsp;fire.</p>
<p>My first reaction here is <a href="http://www.thedailymash.co.uk/news/health/leave-bacon-out-of-it,-health-experts-warned-20071031506/">step away from the bacon, son, leave the
bacon out of this</a>. The localStorage <span class="caps">API</span> seems to have a few quoted
problems, the main ones being that it&#8217;s synchronous, it does file <span class="caps">IO</span>,
and it&#8217;s got bad event support. Put against that, rather snidely it
seems, is the benefit that &#8220;it&#8217;s easy to&nbsp;use&#8221;.</p>
<p>Did I miss a meeting? Is being easy to use suddenly a bad thing? Isn&#8217;t
that one of the major benefits of using Apple stuff, that it makes sense
and people can get it without a PhD in computer science? Or does that
only apply to <em>users</em>, who are presumably too busy on the sofa with a
bag of Cheetos, and not to <em>developers</em>, who are meant to do things the
hard way whenever&nbsp;possible?</p>
<p>Doing file <span class="caps">IO</span> and having bad event support are, certainly, issues with
localStorage if you&#8217;re trying to use it for any kind of really serious
data storage. If you&#8217;re Gmail, maybe you want something better. But you
know what? Most of the things I build aren&#8217;t Gmail, and most of the
things you build aren&#8217;t either. I don&#8217;t need event support for
localStorage; I just want to stash a value in it and then move on.
That&#8217;s all. Doing file <span class="caps">IO</span>… well, any storage mechanism had better be
doing file <span class="caps">IO</span> at <em>some</em> point so that my data gets saved to&nbsp;disc!</p>
<p>Ah, no, say the detractors, but it&#8217;s <em>synchronous</em>. That&#8217;s bad: it
blocks. This seems to boil down to two problems: it might block my tab,
and it might block other people&#8217;s tabs. Now, that&#8217;s an issue, right
enough. However, blocking my tab is something that I can think about and
decide whether I&#8217;m prepared to run the risk or not. Because what you&#8217;re
asking for is that I replace&nbsp;this:</p>
<p><code>localStorage.setItem("key", "value");</code></p>
<p>with&nbsp;this</p>
<div class="highlight"><pre><span class="nx">storeSomething</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">indexedDB</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">&quot;mydbname&quot;</span><span class="p">,</span>
        <span class="s2">&quot;This is a description of the database.&quot;</span><span class="p">);</span>
    <span class="nx">request</span><span class="p">.</span><span class="nx">onsuccess</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">v</span> <span class="o">=</span> <span class="s2">&quot;1.0&quot;</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">db</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">result</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">v</span><span class="o">!=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">version</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">setVrequest</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">setVersion</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span>
            <span class="nx">setVrequest</span><span class="p">.</span><span class="nx">onsuccess</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">createObjectStore</span><span class="p">(</span>
                    <span class="s2">&quot;myobjectstore&quot;</span><span class="p">,</span> 
                    <span class="p">{</span><span class="nx">keyPath</span><span class="o">:</span> <span class="s2">&quot;timeStamp&quot;</span><span class="p">});</span>
                <span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">store</span><span class="p">.</span><span class="nx">put</span><span class="p">({</span><span class="nx">key</span><span class="o">:</span> <span class="nx">value</span><span class="p">,</span> 
                    <span class="s2">&quot;timeStamp&quot;</span> <span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">()});</span>
                <span class="nx">request</span><span class="p">.</span><span class="nx">onsuccess</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// now carry on with what I was doing</span>
                <span class="p">};</span>
            <span class="p">};</span>
        <span class="p">}</span>
    <span class="p">};</span>
<span class="p">}</span>
</pre></div>


<p>and you know what? Given that choice… I believe I might at least
sometimes choose that blocking my tab for a microsecond and very
occasionally blocking my tab for two whole seconds is actually <span class="caps">OK</span>. I&#8217;m
allowed! It&#8217;s my&nbsp;tab!</p>
<p>Fine, I&#8217;m being a bit facetious. There are problems with localStorage,
and it would be good to see them resolved. But there are alternatives
other than &#8220;you must ditch it and use IndexedDB, Mr Developer&#8221;, I think.
What would be wrong with providing an asynchronous variant of
localStorage, so I do
<code>localStorage.setItemAsync("key", "value", function() { carryon... })</code>?
Mozilla say &#8220;Implement localStorage in an asynchronous fashion in
browsers – actively disregarding the spec? (this could set a dangerous
precedent though)&#8221;, as if the idea of the browser manufacturers working
together to adjust the spec is just impossible; did I miss something
there? The spec process is open to stuff being adjusted or added to;
that&#8217;s the point of it, right? And localStorage use in my tab blocking
other people&#8217;s tabs… I can&#8217;t think of a nice way of saying &#8220;that&#8217;s a
browser issue&#8221;, but it is. I feel sad having to say that, because I know
that the engineers at Mozilla and other places have done superhuman work
in this area and will continue to do so, but really one tab blocking
causing others to block is surely something which is a problem for more
than just&nbsp;localStorage?</p>
<p>There are problems with localStorage. Real ones. But I think that those
calling for its complete removal are vastly underestimating the
attractiveness of an <span class="caps">API</span> that&#8217;s easy to use, and also vastly
underestimating how annoying it is to be forced to use something way
more complicated because it copes better with pathological cases. I&#8217;d
love to hear more argument on this subject, but I don&#8217;t want it to look
like there&#8217;s a consensus around &#8220;it must go&#8221;. Someone needs to speak up
for developers who just wanna get stuff done, like&nbsp;me&#8230;</p>
		</div> <!--/#entry-content-->
		<ul class="neighbours-links">
		<li><a href="http://www.kryogenix.org/days/2012/03/16/ubuntu-accomplishments-and-ubuntu-one/">Previous post</a></li>
		<li><a href="http://www.kryogenix.org/days/2012/03/27/this-time-more-than-any-other-time/">Next post</a></li>
		</ul>
	</div> <!--/#main-->
</div>  <!--/#post-->
<div id="webmentions">
<h4>More in the discussion (powered by <a href="http://indiewebcamp.com/Webmention">webmentions</a>)</h4>
	<ul>
		<li><img src="https://twitter.com/rem/profile_image?size=original">
			Remy Sharp responded at
		<a href="https://twitter.com/rem/status/607991466091290626">twitter.com</a>
		<span class="wm-summary">			@sil @slightlylate if it makes anyone feel better, there's a commit waiting to go live in jsbin, that puts the code font in localStorage.
</span></li>
		<li><img src="https://twitter.com/sil/profile_image?size=original">
			Stuart Langridge responded at
		<a href="https://twitter.com/sil/status/607991622349897728">twitter.com</a>
		<span class="wm-summary">			@rem rock and roll. :)
</span></li>
	</ul>
<form id="wmform" method="POST" action="https://webmention.herokuapp.com/api/webmention">
	<label>Did you link to this post? Enter your page's URL:
	<input type="url" name="source"></label>
	<input type="hidden" name="target" value="http://www.kryogenix.org/days/2012/03/20/step-away-from-the-localstorage/">
	<input type="submit" value="Add link">
</form>
<script src="http://www.kryogenix.org/days/theme/live-webmentions.js"></script>
</div>

<p id="oldcomments"></p>
<script>
var aurl = '2012/03/20/step-away-from-the-localstorage/';
var parts = aurl.split('/');
if (parts[parts.length-1] === "") { parts = parts.slice(0, parts.length-1); }
var comurl = "/oldcomments/" + parts.join("-") + ".html";
var x = new XMLHttpRequest();
x.open("HEAD", comurl, true);
x.onreadystatechange = function() {
	if (x.readyState == 4) {
		if (x.status == 200) {
			document.getElementById("oldcomments").innerHTML = '<a href="' + comurl + '">See pre-2014 comments on this post</a>';
		}
	}
};
x.send();
</script>

		</div>
		
		<div id="footer">
			<p>Powered by <a href="http://pelican.readthedocs.org">Pelican</a>, theme by <a href="http://bunnyman.info">tBunnyMan</a>.</p>
				<script type="text/javascript">
					var _gaq = _gaq || [];
					_gaq.push(['_setAccount', 'UA-331575-1']);
					_gaq.push(['_trackPageview']);
					(function() {
						var ga = document.createElement('script'); 
						ga.type = 'text/javascript'; ga.async = true;
						ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
						var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
					})();

					// from https://paul.kinlan.me/detecting-injected-content/
					var detectInjection = function(knownHostsArray) {
						var requests = window.performance.getEntriesByType("resource");
						var unknownHosts = []; var knownHosts = {}; var foundHosts = {};
						for (var knownHost in knownHostsArray) {
							knownHosts[knownHostsArray[knownHost]] = true;
						}
						for (var requestIdx = 0; requestIdx < requests.length; requestIdx++) {
							var request = requests[requestIdx];
							var url = new URL(request.name);
							var host = url.host;
							// Aggregate all the requests from a host
							if(host in foundHosts) { foundHosts[host].push(request); } else { foundHosts[host] = new Array(request); }
						}
						for(var foundHost in foundHosts) {
							// If an unknown host is found, add it to a list.
							if(!(foundHost in knownHosts)) { unknownHosts.push(foundHost); }
						}
						return unknownHosts;
					};
					window.addEventListener("load", function() {
						var scripts = detectInjection(["kryogenix.org", "www.kryogenix.org", "www.google-analytics.com"]);
						if(!!scripts === true && scripts.length > 0) {
							for(var scriptsIdx = 0; scriptsIdx < scripts.length; scriptsIdx++) {
								var scr = scripts[scriptsIdx];
								_gaq.push(['trackEvent', 'ScriptLoads', 'UnknownHost', scr]);
							}
						}
					});
				</script>
		</div><!-- /#footer -->
	</div><!-- /#container -->
	<div style="display:none"></div>
</body>
</html>