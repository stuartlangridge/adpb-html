<!DOCTYPE html>
<html lang="en">
<head>
		<title>as days pass by &mdash; Using the content hub on Ubuntu</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<link rel="profile" href="http://gmpg.org/xfn/11" />
		<link rel="stylesheet" type="text/css" href="//www.kryogenix.org/days/theme/css/style.css" />
		<link rel="stylesheet" id="oswald-css" href="https://fonts.googleapis.com/css?family=Oswald&#038;ver=3.3.2" type="text/css" media="all">
		<link href="https://fonts.googleapis.com/css?family=Raleway:400,700,700italic,400italic&amp;subset=latin,latin-ext" rel="stylesheet" type="text/css">
		<link rel="stylesheet" type="text/css" href="//www.kryogenix.org/days/theme/css/simple-footnotes.css" />
		<link rel="icon" type="image/png" href="/favicon.png" />
		<style type="text/css">
			body.custom-background { background-color: #f5f5f5; }
		</style>
		<link rel="alternate" type="application/rss+xml"
			title="as days pass by"
			href="//www.kryogenix.org/days/feed" /> 
		<!--[if lte IE 8]><script src="//www.kryogenix.org/days/theme/js/html5shiv.js"></script><![endif]-->
		<link rel="webmention" href="https://webmention.herokuapp.com/api/webmention" />
		<link rel="feed" href="http://www.kryogenix.org/days/archives/"> 
</head>

<body class="home blog custom-background single-author" >
	<div id="container">
		<div id="header">
				<p>A blog by <a href="//www.kryogenix.org/">Stuart Langridge</a></p>
				<h1 id="site-title"><a href="//www.kryogenix.org/days">as days pass by</a></h1>
<h2 id="site-description">scratched tallies on the prison wall</h2>		</div><!-- /#banner -->
		
		<div id="menu">
			<div class="menu-navigation-container">
				<ul id="menu-navigation" class="menu">
						<li  class="active" class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/">Kryogenix Consulting</a></li>
						<li  class="active" class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/days/archives">All posts, ever</a></li>
						<li  class="active" class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/code">Code</a></li>

				</ul>
			</div> <!--/#menu-navigation-container-->
		</div><!-- /#menu -->
		
		<div class="page-title">
		</div>
	
		<div id="contents">

<div class="post type-post status-publish format-standard hentry category-general h-entry" id="post">
	<div class="entry-meta">
		<div class="date"><a href="//www.kryogenix.org/days/2015/08/20/using-the-content-hub-on-ubuntu/"><time 
			class="dt-published" datetime="2015-08-20T02:19:00">Aug 20 2015</time></a>
			<span class="byline h-card">By <a class="p-author" href="//www.kryogenix.org/days/"><img src="http://kryogenix.org/images/hackergotchi-simpler.png" class="u-photo" alt=""> <span class="p-name">sil</span></a></span>
		</div>
	</div> <!-- /#entry-meta -->
	<div class="main">
		<h2 class="entry-title">
			<a class="u-url p-name" href="//www.kryogenix.org/days/2015/08/20/using-the-content-hub-on-ubuntu/" title="Permalink to Using the content hub on Ubuntu" rel="bookmark">Using the content hub on&nbsp;Ubuntu</a>
		</h2>
		<div class="entry-content e-content">
			<p>On an Ubuntu phone, apps are<sup id="sf-using-the-content-hub-on-ubuntu-1-back"><a title="correctly" href="#sf-using-the-content-hub-on-ubuntu-1" class="simple-footnote">1</a></sup> isolated from one another; each app has its own little folder where <em>its</em> files go, and no other app can intrude. This, obviously, requires some way to exchange files between apps, because frankly there are times when my epub ebook is in my file downloader app and I need it in my ebook reader app. And so on.</p>
<p>To deal with this, Ubuntu provides the Content Hub: a way for an app to say “I need a photo” and all the other apps on your phone which have photos to say “I have photos! Ask me! Me!”.</p>
<p>This is, at a high level, the right thing to do. If my app wants to use a picture of you as an avatar, it should not be able to snarf your whole photo gallery and do what it wants with it. More troubling yet, adding some new social network app should not give it access to your whole address book so that it can hassle your friends to join, or worse just snaffle that information and store it away on its own server for future reference. So when some new app needs a photo of you to be an avatar, it asks the content hub; you, the punter, choose an app to provide that photo, and then a photo from within that app, and our avatar demander gets that photo, and none of the pictures of your kids or your holiday or whatever you take photos of. This is, big picture<sup id="sf-using-the-content-hub-on-ubuntu-2-back"><a title="ha!" href="#sf-using-the-content-hub-on-ubuntu-2" class="simple-footnote">2</a></sup> a good idea.</p>
<p>Sadly, the content hub is spectacularly under-documented, so actually <em>using</em> it in your Ubuntu apps is jolly hard work. However, with an assist<sup id="sf-using-the-content-hub-on-ubuntu-3-back"><a title="a bit more than that, if I’m honest" href="#sf-using-the-content-hub-on-ubuntu-3" class="simple-footnote">3</a></sup> from Michael Zanetti, I now understand how to offer files you have to others via the content hub. So I come to explain this to you.</p>
<p>First, you need permission to access the content hub at all. So, in your <code>appname.apparmor</code> file<sup id="sf-using-the-content-hub-on-ubuntu-4-back"><a title="or whatever you called it; hooks.$APPNAME.apparmor in manifest.json" href="#sf-using-the-content-hub-on-ubuntu-4" class="simple-footnote">4</a></sup>, add <code>content_exchange_source</code>.<sup id="sf-using-the-content-hub-on-ubuntu-5-back"><a title="This is more confusing than it should be. If you’re using Ubuntu SDK as your editor, then clicking the big “+” button will load a list of possible apparmor permissions. Don’t double-click a permission; this will just show you what it means in code terms, rather irrelevantly. Instead, choose your permission (content_exchange_source in this case) and then say Add" href="#sf-using-the-content-hub-on-ubuntu-5" class="simple-footnote">5</a></sup> This tells Ubuntu that you’re prepared to provide files for others (you are a “source” of data). You then need to, also in <code>manifest.json</code>, configure what you’re allowed to do with the content hub; add a <code>hooks.content-hub</code> key which names a file (<code>myappname.content-hub</code> or whatever you prefer). That file that you just named needs to also be json, and looks something like <code>{"source": ["all"]}</code>, which dictates which sorts of files you want to be a source <em>for</em>.<sup id="sf-using-the-content-hub-on-ubuntu-6-back"><a title="you can also do `{“source”:[“pictures”]}. There may be other things you can write in there instead of “all” or “pictures”, but the documentation is surlily silent on such things." href="#sf-using-the-content-hub-on-ubuntu-6" class="simple-footnote">6</a></sup> Once you’ve done all this, you’re allowed to use the content hub. So now we explore how.</p>
<p>In your <span class="caps">QML</span> app, you need to add a <code>ContentPeerPicker</code>. This is a normal <span class="caps">QML</span> Item; specifically, showing it to the user is <em>your</em> responsibility. So you might want to drop it in a Dialog, or a Page, or you might just put it at top level with <code>visible:hidden</code> and then show it when appropriate (such as when your user taps a file or image or whatever that they want to open in another app).</p>
<p>Your <code>ContentPeerPicker</code> should look, at minimum, like this:</p>
<div class="highlight"><pre><span class="n">ContentPeerPicker</span> <span class="p">{</span>
    <span class="nl">handler:</span> <span class="n">ContentHandler</span><span class="p">.</span><span class="n">Destination</span>
    <span class="nl">contentType:</span> <span class="n">ContentType</span><span class="p">.</span><span class="n">All</span>
    <span class="nl">onPeerSelected:</span> <span class="p">{</span>
        <span class="n">var</span> <span class="n">transfer</span> <span class="o">=</span> <span class="n">peer</span><span class="p">.</span><span class="n">request</span><span class="p">();</span>
        <span class="n">var</span> <span class="n">items</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Array</span><span class="p">();</span>
        <span class="n">exportItem</span><span class="p">.</span><span class="n">url</span> <span class="o">=</span> <span class="cm">/* whatever the URL of the file you want to share is */</span><span class="p">;</span>
        <span class="n">items</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">exportItem</span><span class="p">);</span>
        <span class="n">transfer</span><span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="n">items</span><span class="p">;</span>
        <span class="n">transfer</span><span class="p">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">ContentTransfer</span><span class="p">.</span><span class="n">Charged</span><span class="p">;</span>
        <span class="n">cpp</span><span class="p">.</span><span class="n">visible</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nl">onCancelPressed:</span> <span class="n">cpp</span><span class="p">.</span><span class="n">visible</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>The important parts here are <code>handler: ContentHandler.Destination</code> (which means “I am a source for files which need to be opened in some other app”), and <code>contentType: ContentType.All</code> (which means “I am a source for all types of file”).<sup id="sf-using-the-content-hub-on-ubuntu-7-back"><a title="You can see all the possible content types in the Ubuntu SDK ContentType documentation (https://developer.ubuntu.com/api/apps/qml/sdk-15.04/Ubuntu.Content.ContentType/), with misleading typos and all" href="#sf-using-the-content-hub-on-ubuntu-7" class="simple-footnote">7</a></sup> After that<sup id="sf-using-the-content-hub-on-ubuntu-8-back"><a title="as mzanetti excellently described it" href="#sf-using-the-content-hub-on-ubuntu-8" class="simple-footnote">8</a></sup> show it to the user somehow and connect to its <code>onPeerSelected</code> method. When the user picks some other app to export to from this new Item, <code>onPeerSelected</code> will be called; when the callback <code>onPeerSelected</code> is called, the <code>peer</code> property is valid. Get a transfer object to this peer: <code>var transfer = peer.request();</code>, and then you need to fill in <code>transfer.items</code>. This is a JavaScript list of <code>ContentItem</code>s; specifically, define <code>ContentItem { id: exportItem }</code> in your app, and then make a “list” of one item with <code>var items = new Array(); exportItem.url = PATH_TO_FILE_YOU_ARE_EXPORTING; items.push(exportItem); transfer.items = items;</code>.<sup id="sf-using-the-content-hub-on-ubuntu-9-back"><a title="You can transfer more than one item, here." href="#sf-using-the-content-hub-on-ubuntu-9" class="simple-footnote">9</a></sup> After that, set <code>transfer.state = ContentTransfer.Charged</code> and your transfer begins; you can hide the <code>ContentPeerPicker</code> by setting <code>cpp.visible=false</code> at this point.</p>
<p>And that’s how to export files over the Content Hub so that your app can make files available to others. There’s a second half of this (other apps export the files; your app wants to retrieve them, so let’s say they’re an app which needs a photo, and you’re an app with photos), which I’ll come to in a future blog post.</p>
<p>As you can see from the large number of footnotes<sup id="sf-using-the-content-hub-on-ubuntu-10-back"><a title="not this one, though" href="#sf-using-the-content-hub-on-ubuntu-10" class="simple-footnote">10</a></sup> there are a number of caveats with this whole process, in particular that a bunch of it isn’t documented. It will, I’m sure, over time, get better. Meanwhile, the above gives you the basics. Have fun.</p><ol class="simple-footnotes"><li id="sf-using-the-content-hub-on-ubuntu-1">correctly <a href="#sf-using-the-content-hub-on-ubuntu-1-back" class="simple-footnote-back">↩</a></li><li id="sf-using-the-content-hub-on-ubuntu-2">ha! <a href="#sf-using-the-content-hub-on-ubuntu-2-back" class="simple-footnote-back">↩</a></li><li id="sf-using-the-content-hub-on-ubuntu-3">a bit more than that, if I’m honest <a href="#sf-using-the-content-hub-on-ubuntu-3-back" class="simple-footnote-back">↩</a></li><li id="sf-using-the-content-hub-on-ubuntu-4">or whatever you called it; <code>hooks.$APPNAME.apparmor</code> in <code>manifest.json</code> <a href="#sf-using-the-content-hub-on-ubuntu-4-back" class="simple-footnote-back">↩</a></li><li id="sf-using-the-content-hub-on-ubuntu-5">This is more confusing than it should be. If you’re using Ubuntu <span class="caps">SDK</span> as your editor, then clicking the big “+” button will load a list of possible apparmor permissions. Don’t double-click a permission; this will just show you what it means in code terms, rather irrelevantly. Instead, choose your permission (<code>content_exchange_source</code> in this case) and then say Add <a href="#sf-using-the-content-hub-on-ubuntu-5-back" class="simple-footnote-back">↩</a></li><li id="sf-using-the-content-hub-on-ubuntu-6">you can also do `{“source”:[“pictures”]}. There may be other things you can write in there instead of “all” or “pictures”, but the documentation is surlily silent on such things. <a href="#sf-using-the-content-hub-on-ubuntu-6-back" class="simple-footnote-back">↩</a></li><li id="sf-using-the-content-hub-on-ubuntu-7">You can see all the possible content types in the Ubuntu <span class="caps">SDK</span> ContentType documentation (https://developer.ubuntu.com/api/apps/qml/sdk-15.04/Ubuntu.Content.ContentType/), with misleading typos and all <a href="#sf-using-the-content-hub-on-ubuntu-7-back" class="simple-footnote-back">↩</a></li><li id="sf-using-the-content-hub-on-ubuntu-8">as mzanetti excellently described it <a href="#sf-using-the-content-hub-on-ubuntu-8-back" class="simple-footnote-back">↩</a></li><li id="sf-using-the-content-hub-on-ubuntu-9">You can transfer more than one item, here. <a href="#sf-using-the-content-hub-on-ubuntu-9-back" class="simple-footnote-back">↩</a></li><li id="sf-using-the-content-hub-on-ubuntu-10">not this one, though <a href="#sf-using-the-content-hub-on-ubuntu-10-back" class="simple-footnote-back">↩</a></li></ol>
		</div> <!--/#entry-content-->
		<ul class="neighbours-links">
		<li><a href="//www.kryogenix.org/days/2015/08/14/fooling-the-natives/">Previous post</a></li>
		<li><a href="//www.kryogenix.org/days/2015/09/23/the-platform-is-just-another-library/">Next post</a></li>
		</ul>
	</div> <!--/#main-->
</div>  <!--/#post-->
<div id="webmentions">
<h4>More in the discussion (powered by <a href="http://indiewebcamp.com/Webmention">webmentions</a>)</h4>
	<ul>
		<li><img src="https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=50">
			Michael Zanetti responded at
		<a href="https://plus.google.com/105839534016416729197/posts/daw3WSWmNWc">plus.google.com</a>
		<span class="wm-summary">			Troubles with adding Content Hub support? Check out this tutorial!http://www.kryogenix.org/days/2015/08/20/using-the-content-hub-on-ubuntu/﻿ as day&hellip;
</span></li>
		<li><img src="https://lh4.googleusercontent.com/-x0S-5QktM2Y/AAAAAAAAAAI/AAAAAAAAAEk/SjdPF1ddtno/photo.jpg?sz=50">
			Bob Looter responded at
		<a href="https://plus.google.com/105839534016416729197/posts/daw3WSWmNWc">plus.google.com</a>
		<span class="wm-summary">			Troubles with adding Content Hub support? Check out this tutorial!http://www.kryogenix.org/days/2015/08/20/using-the-content-hub-on-ubuntu/﻿ as day&hellip;
</span></li>
	</ul>
<form id="wmform" method="POST" action="https://webmention.herokuapp.com/api/webmention">
	<label>Did you link to this post? Enter your page's URL:
	<input type="url" name="source"></label>
	<input type="hidden" name="target" value="http://www.kryogenix.org/days/2015/08/20/using-the-content-hub-on-ubuntu/">
	<input type="submit" value="Add link">
</form>
<script src="//www.kryogenix.org/days/theme/live-webmentions-cors.js"></script>
</div>

<p id="oldcomments"></p>
<script>
var aurl = '2015/08/20/using-the-content-hub-on-ubuntu/';
var parts = aurl.split('/');
if (parts[parts.length-1] === "") { parts = parts.slice(0, parts.length-1); }
var tooNewForOldComments = false;
if (parts[0].match(/^[0-9]+$/)) {
	var asnum = parseInt(parts[0], 10);
	if (!isNaN(asnum) && asnum > 2014) {
		tooNewForOldComments = true;
	}
}
if (!tooNewForOldComments) {
	var comurl = "/oldcomments/" + parts.join("-") + ".html";
	var x = new XMLHttpRequest();
	x.open("HEAD", comurl, true);
	x.onreadystatechange = function() {
		if (x.readyState == 4) {
			if (x.status == 200) {
				document.getElementById("oldcomments").innerHTML = '<a href="' + comurl + '">See pre-2014 comments on this post</a>';
			}
		}
	};
	x.send();
}
</script>

		</div>
		
		<div id="footer">
			<p>Powered by <a href="http://pelican.readthedocs.org">Pelican</a>, theme by <a href="http://bunnyman.info">tBunnyMan</a>.</p>
				<script type="text/javascript">
					var _gaq = _gaq || [];
					_gaq.push(['_setAccount', 'UA-331575-1']);
					_gaq.push(['_trackPageview']);
					(function() {
						var ga = document.createElement('script'); 
						ga.type = 'text/javascript'; ga.async = true;
						ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
						var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
					})();

					// from https://paul.kinlan.me/detecting-injected-content/
					var detectInjection = function(knownHostsArray) {
						var requests = window.performance.getEntriesByType("resource");
						var unknownHosts = []; var knownHosts = {}; var foundHosts = {};
						for (var knownHost in knownHostsArray) {
							knownHosts[knownHostsArray[knownHost]] = true;
						}
						for (var requestIdx = 0; requestIdx < requests.length; requestIdx++) {
							var request = requests[requestIdx];
							var url = new URL(request.name);
							var host = url.host;
							// Aggregate all the requests from a host
							if(host in foundHosts) { foundHosts[host].push(request); } else { foundHosts[host] = new Array(request); }
						}
						for(var foundHost in foundHosts) {
							// If an unknown host is found, add it to a list.
							if(!(foundHost in knownHosts)) { unknownHosts.push(foundHost); }
						}
						return unknownHosts;
					};
					window.addEventListener("load", function() {
						var scripts = detectInjection(["kryogenix.org", "www.kryogenix.org", "www.google-analytics.com"]);
						if(!!scripts === true && scripts.length > 0) {
							for(var scriptsIdx = 0; scriptsIdx < scripts.length; scriptsIdx++) {
								var scr = scripts[scriptsIdx];
								_gaq.push(['trackEvent', 'ScriptLoads', 'UnknownHost', scr]);
							}
						}
					});
				</script>
		</div><!-- /#footer -->
	</div><!-- /#container -->
	<div style="display:none"></div>
</body>
</html>