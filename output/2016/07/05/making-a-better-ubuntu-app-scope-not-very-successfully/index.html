<!DOCTYPE html>
<html lang="en">
<head>
		<title>as days pass by &mdash; Making a better Ubuntu app scope (not very successfully)</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="profile" href="http://gmpg.org/xfn/11" />
		<meta name="Description" content="Stuart Langridge of Kryogenix Consulting, for consultancy and custom development on the web and devices">
        <meta property="og:title" content="as days pass by &mdash; Making a better Ubuntu app scope (not very successfully)">
        <meta property="og:type" content="website">
        <meta property="og:site_name" content="as days pass by">
        <meta property="og:description" content="A post by Stuart Langridge (sil)">
        <meta property="og:image" content="https://www.kryogenix.org/days/2016/07/05/making-a-better-ubuntu-app-scope-not-very-successfully/index.html.og_image.png">
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:site" content="@sil">
        <meta name="twitter:image" content="https://www.kryogenix.org/days/2016/07/05/making-a-better-ubuntu-app-scope-not-very-successfully/index.html.og_image.png">
		<link rel="stylesheet" type="text/css" href="../../../../theme/css/adpb.css" />
		<link rel="stylesheet" type="text/css" href="../../../../theme/css/simple-footnotes.css" />
		<link rel="icon" type="image/png" href="/favicon.png" />
		<link rel="alternate" type="application/rss+xml"
			title="as days pass by"
			href="https://www.kryogenix.org/days/feed" /> 
		<meta property="fediverse:creator" content="@sil@mastodon.social" />
		<link rel="webmention" href="https://webmention.herokuapp.com/api/webmention" />
		<link rel="feed" href="https://www.kryogenix.org/days/archives/"> 
</head>

<body class="home blog custom-background single-author" >
		<header>
				<p>A blog by <a href="https://www.kryogenix.org/">Stuart Langridge</a></p>
				<h1 id="site-title"><a href="https://www.kryogenix.org/days">as days pass by</a></h1>
<h2 id="site-description">scratched tallies on the prison wall</h2>		</header><!-- /#banner -->
		
		<nav>
			<ul>
				<li><a href="/">Kryogenix Consulting</a></li>
				<li><a href="/days/archives">All posts, ever</a></li>
				<li><a href="/code">Code</a></li>
			</ul>
		</nav>
		
		<div class="page-title">
		</div>
	
		<div id="contents">

<div class="post type-post status-publish format-standard hentry category-general h-entry" id="post">
	<div class="entry-meta">
		<div class="date"><a href="https://www.kryogenix.org/days/2016/07/05/making-a-better-ubuntu-app-scope-not-very-successfully/"><time 
			class="dt-published" datetime="2016-07-05T00:27:00+01:00">Jul 05 2016</time></a>
		</div>
	</div> <!-- /#entry-meta -->
	<div class="main">
		<h2 class="entry-title">
			<a class="u-url p-name" href="https://www.kryogenix.org/days/2016/07/05/making-a-better-ubuntu-app-scope-not-very-successfully/">Making a better Ubuntu app scope (not very successfully)</a>
		</h2>
		<div class="entry-content e-content">
			<p>I was rather excited to discover the idea that one could change the icons used on an Android phone's home screen. (As Sam Hewitt <a href="https://plus.google.com/u/0/+StuartLangridge/posts/A1XypgwkMyU">put it</a>, I have "become a themer".) I didn't know this was doable, and I went from not knowing this to having it done in the space of about half an hour. It is rare that something just works this nicely; I've been living my life a long time and I know how it works. So far, the other shoe hasn't dropped, which is encouraging.</p>
<h3>At first, there was Android</h3>

<p>Anyway, my Android home screen now looks like this:</p>
<p><img src="https://www.kryogenix.org/random/android-minimal.jpg"></p>

<p>I'm pretty pleased with that. (The lock screen is even more minimal and pretty, but we're not talking about lock screens today: see <a href="https://plus.google.com/u/0/+StuartLangridge/posts/A1XypgwkMyU">the G+ post</a> for what that looks like.)</p>
<p>There is a UI concern here -- in general, I don't like using icons without text to indicate a thing, because it means you're spending cognitive time remembering <em>what an icon stands for</em> rather than <em>what it's similar to</em>. That is: icons are quite good for, say, files where you want to see that all of these are <code>.txt</code> files, but they're not good for actions where you have to remember what a "heart" or some obscure little symbol means. I've lost count of the number of times when I've used a new app which only has icons and not text labels on its buttons and I have <em>no idea</em> what half the icons <em>do</em>; a few things are enshrined by everyone using them (a Share icon, a Save icon, an Open icon, etc) but most of the time using an icon alone to indicate an action or an app is a bad idea. However, this is an exception to that rule. I am very familiar with my home screen; the set of apps on it do not change very much at all. So there's minimal cognitive load in remembering that <em>this</em> icon is for Twitter and <em>that</em> one is for Moon Reader. I do a reasonable proportion of that by spatial arrangement; the icons don't move around, and I am familiar and trained in where they are. You wouldn't want to ship a phone which looks like this to a new user, but it's a perfectly good experience for me, with my own personal home screen that I know well.</p>
<p>How is this beautiful miracle achieved? Well. The default Android home screen doesn't let you change the icons used for apps. So when I discovered the (free!) <a href="https://play.google.com/store/apps/details?id=com.natewren.linesfree&amp;hl=en">Lines icon set</a> in the Play store my immediate thought was, cor, how does that work? And the answer is: use a different home screen app (in Android parlance, they're called <em>launchers</em>). So I installed <a href="https://play.google.com/store/apps/details?id=com.teslacoilsw.launcher&amp;hl=en">Nova Launcher</a>. (This also had the rather nice benefit of allowing me to remove the hated Google search bar; I never, ever, ever used that because it shows results in some Google app rather than the web, meaning that you can't long-press on images to save them or on links to open in a new tab. Pack it in, Google. Open in the browser. It's good at that.) A little bit of setup with Nova Launcher and Lines and, lo, I had the nice minimal icons and pretty dark wallpaper (which came with Lines). Nova Launcher doesn't let you resize the icons, and by default they're a bit small, but you can buy the <a href="https://play.google.com/store/apps/details?id=com.teslacoilsw.launcher.prime&amp;hl=en">Nova Launcher Prime</a> add-on to enable that, and it was fifty pence so that's a no-brainer. The Lines icon set is both worryingly comprehensive (they claim to have over two thousand icons!) and equally worryingly incomplete (with a million apps in the Play store they're never going to carry them all, but not having Telegram? Seriously?) and so I added two more similar-looking icon sets (<a href="https://play.google.com/store/apps/details?id=com.ryanmkelly.me.min&amp;hl=en">Min</a> and <a href="https://play.google.com/store/apps/details?id=jimonen.glyphsyiconpack&amp;hl=en">Glyphsy</a>) to give me a wider choice. A bunch of tweaking of icon sizes, icon choices, margin sizes, and so on later and I have the screen above, and every time I look at it I like it a little more. Ultra-happy with it.</p>
<h3>And then there was Ubuntu</h3>

<p>I thought to myself, hang on, it ought to be possible to do the same thing with Ubuntu phone, right? One can write a custom scope which looks like that and shows all one's apps, and add it to the Dash as the only scope, and then you've got a cool-looking app-launcher home screen. Sweet. That's what I want. And it'll give me an excuse to play with all the new scopes stuff and learn something about it.</p>
<p>Not so fast, grasshopper.</p>
<p>Here's my basic idea. The existing apps scope is annoyingly slow; I'm sure it does a whole bunch of stuff and that's why, but it's slow to load, slow to scroll, and slow to react to things changing. This is obviously being worked on by the Canonical team and I'm sure it'll get better, but currently it's pretty frustrating. So I thought: what I'll do is this. I'll add a <a href="http://click.readthedocs.io/en/latest/hooks.html">click hook</a> so when apps get installed and removed I can update a sqlite database, and then my scope will just hit that database rather than inspecting the filesystem and loading loads of files. That database can also hold the locations of icons in my custom "wireframe" icon theme, and it'll use those icons for the apps. So it'll be fast and have custom icons, and tapping an icon will launch that app via <a href="http://web.archive.org/web/20160705002700/https://developer.ubuntu.com/en/phone/platform/guides/url-dispatcher-guide/">an <code>application:///</code> url</a>. Job's a good'un, etc. Off down the pub.</p>
<p>It was not as easy as I had hoped.</p>
<p>There are a few things that made the task difficult and which are basically my fault and for which no blame attaches to the Ubuntu team. Firstly, I'm still running Ubuntu 14.04. This is because it's an long-term-support release, and LTSes don't offer to upgrade to the next LTS release (16.04, which came out in April) until the first point release (16.04.1, which isn't out at time of writing). This is so the new LTS gets a bit of testing before it hits all the people who desire stability, and is a good idea, and I am entirely happy with it. Secondly, I wanted to write the scope in JavaScript; one can write Unity 8 scopes in C++ (which I can't do), Go (which I can't do), and JS via node (which I am completely comfortable with). But the JS scopes stuff is new, and so doesn't exist in 14.04. This meant that I had to do a great deal of faffing around in lxc containers to get a working version of a JS scope. However, that faffery did actually work out in the end, and it's hard to see the need for it as due to anything more than my own desire to not upgrade away from the latest stable release LTS. So, no blame there, as mentioned. After a bit of poking, I managed to get a JavaScript scope, and some discussions with Brian Douglass and one tiny bash deploy script later (which basically does <code>click build .</code> and then <code>adb push</code>es the <code>.click</code> file to my Bq E4.5 and <code>pkcon install-local</code>s it), I had a scope that I'd written running on the phone. Hooray! Now to make that scope actually do and look as I want it to.</p>
<p>This is where we run into problems. The JavaScript scopes stuff is, admittedly, new, but it had two major issues that caused me a great deal of grief. The first is that making async <code>fs.readdir</code> calls early in a scope <code>search()</code> handler were making my scope crash, and sometimes crashing all of Unity. (<a href="https://bugs.launchpad.net/unity-js-scopes/+bug/1598967">LP#1598967</a>) Oops. That took some time debugging before I eventually went for the synchronous <code>fs.readdirSync</code>, cursing all the while. Worse, though, is the <code>activate</code> problem. You see, a scope, by default, when a thing is tapped shows you the <em>preview page</em> for that thing. However, you can change things so that a tap on a thing does something directly; in this case, of course, I wanted a tap on one of my app icons to launch that app via the URL dispatcher. To do that, you call <code>set_intercept_activation()</code> on a <a href="http://web.archive.org/web/20160705002700/https://developer.ubuntu.com/api/scopes/js/sdk-15.04.4/ScopeJS.CategorisedResult/">scope icon</a> when you create it, and then Unity will call your scope's <code>runtime_config.activate()</code> method with the details when that icon is tapped; you can then handle it in whatever way you want, or return an <code>ActivationNotHandled</code> type of <code>ActivationResponse</code> to let Unity handle it for you, which in this case means "open the app with the url you provided". (You can see a good example of how this works in Go in <a href="https://github.com/bhdouglass/falcon/blob/master/src/falcon.go#L98">Brian Douglass's Falcon alternative app scope</a>.) However! If you do that in JavaScript, your scope ignores the tap and throws an error about how you <code>returned nullptr from activate()</code>. (<a href="https://bugs.launchpad.net/unity-js-scopes/+bug/1598969">LP#1598969</a>.) As the bug says, "this, in practice, means it's impossible to write a JS scope which allows tapping on a result item to do anything other than show the preview (for example, launching an app)."</p>
<p>(The observant will notice that the <a href="http://web.archive.org/web/20160705002700/https://developer.ubuntu.com/api/scopes/js/sdk-15.04.5/ScopeJS/">JS scopes documentation</a> doesn't actually <em>mention</em> <code>ActivationResponse</code> or even that <code>activate()</code> handlers are possible in <a href="http://web.archive.org/web/20160705002700/https://developer.ubuntu.com/api/scopes/js/sdk-15.04.5/ScopeJS.Scope/"><code>scope.initialize()</code></a>, which will hopefully get better as the docs get written.)</p>
<p>Now, that's just a bug, and I'm sure it'll get fixed (I'm sure they'll all be fixed). It is frustrating (has nobody writing the JS scopes stuff ever <em>tried</em> <code>set_intercept_activation()</code>? Isn't there lots of QA built into the Ubuntu process now?) But it's a temporary thing, I'm sure, and in the same class of "frustrating and show-stopping but will be fixed eventually" things as how <code>unity-js-scopes-tool</code> doesn't build <code>node-pre-gyp</code> packages (<a href="https://bugs.launchpad.net/unity-js-scopes/+bug/1598971">LP#1598971</a>) or that <code>unity-js-scopes-tool</code> seems to actually <em>be</em> the <code>node</code> binary itself but that's carefully kept secret for some reason, or that you have to remove and reinstall an app if you change the apparmor stuff otherwise the changes aren't picked up (<a href="https://bugs.launchpad.net/ubuntu/+source/click/+bug/1549369">LP#1549369</a>) which cost me an hour of banging my head against the desk (thanks mzanetti for helping). They'll get fixed. Move on.</p>
<p>The things which actually stopped me building the scope I wanted weren't these sorts of incidental bugs; they're design decisions saying that what I want should not be possible. I'm hoping that the detail I'm going into here helps to explain <em>why</em> I want these things, and perhaps makes its way back to the team deciding on this stuff and helps to inform their decisions.</p>
<p>For example. You see how my Android screen above has four columns of app icons? Like the Ubuntu apps scope has? Well... my replacement scope can't. Scopes are only allowed three columns of icons. The apps scope has been magically <a href="https://bugs.launchpad.net/ubuntu/+source/unity8/+bug/1490388">hardcoded into Unity</a> to be allowed four columns; nobody else can do that. That's pretty annoying.</p>
<p>Similarly, customisation of the look of a scope is superficially good but actually rather limited. A scope <em>header</em> can have a custom background image, but a scope itself can't; you can pick a colour, but you can't set an image as the background for your scope. (<a href="https://bugs.launchpad.net/ubuntu/+source/unity-scopes-api/+bug/1598973">LP#1598973</a>) Scopes put the "Ubuntu shape" around all your scope icons, but you can turn that off by settings <code>ShapeImages=false</code> in your scope ini file. Except... that doesn't work; it's ignored, and you always get the Ubuntu shape border on every image, whether you want it or not. (<a href="https://bugs.launchpad.net/ubuntu/+source/unity-scopes-api/+bug/1598933">LP#1598933</a>) I understand the idea behind shaping imagery, but it looks heart-stoppingly ugly when done to icons with transparent backgrounds, such as all the "wireframe" icons I planned to use in this project. You can have settings for your scope, but they can't change the <em>appearance</em>, because that stuff's not programmatic; it's in the <code>scope.ini</code> file and can't be changed by code. So I can't allow people to have a dark scope with white icons (as above) or choose a light scope with black icons. Also, making a replacement apps scope is essentially fruitless because the default apps scope cannot be removed. You can't turn it off; it <em>must</em> be present in your Dash. This to me seems strange; I'm fine with you not being able to <em>delete</em> it, but it will always be present in the bottom-edge menu. Fine, maybe making replacement apps scopes is an edge case, but it's hard to get the feeling that my phone is mine when I'm obliged to keep the default apps scope around even if I've got a replacement.</p>
<p>Oh, and the idea of making the scope fast by populating a database? You can't have that, either. Yes, there are click hooks. But you can't install one. They must be stored in <code>/usr/share/click/hooks</code>, and that's part of the system image, which is read-only. What this means is that there's no way that a third-party app will ever be able to be informed of app installs and removals, sadly. I can put an app which requires extra permissions into the <a href="https://open.uappexplorer.com/">Open Store</a>, but even such an app can't install a click hook; I'd have to make it a deb, and even then a deb won't install either unless you mark your image as read-write, which requires plugging it into a computer. Talking someone through that process is close to impossible unless they're the hardest of the hardcore Ubuntu touch hackers. Perhaps click might look in some other folder as well, which <em>is</em> accessible to apps, and have a new apparmor permission protect that folder? Then it would be possible for an application to request that permission and keep a database of installed and removed apps up to date, which would allow us to compete on making a better app launching experience.</p>
<p>So all this means that the best I can do on Ubuntu is this. Ubuntu shapes around the transparent icons, no background imagery, three columns. And that's just not pretty, I'm sad to say.</p>
<p><img src="https://www.kryogenix.org/random/appease.png"></p>

<p>(I freely admit that some of this is down to the icons, which I drew quickly, and some more is down to the E4.5 having much worse screen resolution than my OnePlus X. But those aren't the only things.)</p>
<p>Anyway. I still have my beautiful Android home screen. But I've reluctantly decided that I just can't do that on Ubuntu. Maybe it'll be possible later; maybe these bugs will be fixed and the design decisions revisited. I hope the above explains why I think that's important and what app developers could maybe do if those restrictions are slightly relaxed. Fingers crossed.</p>
		</div> <!--/#entry-content-->
		<ul class="neighbours-links">
		<li><a href="https://www.kryogenix.org/days/2016/06/02/programmatic-progressiveness/">Previous post</a></li>
		<li><a href="https://www.kryogenix.org/days/2016/08/11/feeling-old/">Next post</a></li>
		</ul>

		<div class="hireme">
			I'm currently available for hire, to help you plan, architect, and build new systems, and for technical writing
			and articles. You can take a look at <a href="https://kryogenix.org">some projects I've worked on</a> and
			<a href="https://kryogenix.org/books">some of my writing</a>. If you'd like to talk about your upcoming project,
			do <a href="https://kryogenix.org/contact">get in touch.</a>
		</div>
	</div> <!--/#main-->
</div>  <!--/#post-->
<div id="webmentions">
<h4>More in the discussion (powered by <a href="http://indiewebcamp.com/Webmention">webmentions</a>)</h4>
	<ul><li>(no mentions, yet.)</li></ul>
<form id="wmform" method="POST" action="https://webmention.herokuapp.com/api/webmention">
	<label>Did you link to this post? Enter your page's URL:
	<input type="url" name="source"></label>
	<input type="hidden" name="target" value="https://www.kryogenix.org/days/2016/07/05/making-a-better-ubuntu-app-scope-not-very-successfully/">
	<input type="submit" value="Add link">
</form>
<script src="https://www.kryogenix.org/days/theme/live-webmentions-cors.js"></script>
</div>

<p id="oldcomments"></p>
<script>
var aurl = '2016/07/05/making-a-better-ubuntu-app-scope-not-very-successfully/';
var parts = aurl.split('/');
if (parts[parts.length-1] === "") { parts = parts.slice(0, parts.length-1); }
var tooNewForOldComments = false;
if (parts[0].match(/^[0-9]+$/)) {
	var asnum = parseInt(parts[0], 10);
	if (!isNaN(asnum) && asnum > 2014) {
		tooNewForOldComments = true;
	}
}
if (!tooNewForOldComments) {
	var comurl = "/oldcomments/" + parts.join("-") + ".html";
	var x = new XMLHttpRequest();
	x.open("HEAD", comurl, true);
	x.onreadystatechange = function() {
		if (x.readyState == 4) {
			if (x.status == 200) {
				document.getElementById("oldcomments").innerHTML = '<a href="' + comurl + '">See pre-2014 comments on this post</a>';
			}
		}
	};
	x.send();
}
</script>
<script type="module">
/* jslint esversion: 11 */
try {
	const resp = await fetch("/adpb-popular.json");
	const vals = await resp.json();
	let popular = vals[location.pathname];
	if (!popular && location.pathname.endsWith("/")) {
		popular = vals[location.pathname.replace(/\/$/, "")];
	}
	if (popular && popular.recent_idx != null) {
		let a = document.createElement("a");
		let p = document.createElement("p");
		p.className = "trending";
		a.href = "/adpb-popular.html";
		a.append(`#${popular.recent_idx + 1} in Trending`);
		p.append(a);
		const ec = document.querySelector("div.entry-content");
		ec.insertBefore(p, ec.firstChild);
	}
} catch(e) {
	console.error("Failed to fetch popular list", e);
}
</script>
<!-- <script src="https://www.kryogenix.org/days/theme/unrot-redirect.js"></script> -->
		</div>
		
		<footer>
			<p>Powered by <a href="http://pelican.readthedocs.org">Pelican</a></p>
		</footer>




<div id="loadtimer"></div>
<script>
window.onload = function(){
    setTimeout(function(){
      window.performance = window.performance || 
window.mozPerformance || window.msPerformance || 
window.webkitPerformance || {};
      var t = performance.timing || {};
      if (!t) {
        
        return;
      }
      var start = t.navigationStart,
          end = t.loadEventEnd
          loadTime = (end - start) / 1000;
      var copy = document.getElementById('loadtimer');
      copy.innerHTML += "This page loaded in " + loadTime + " seconds.";
    }, 0); 
}

</script>
</body> </html>