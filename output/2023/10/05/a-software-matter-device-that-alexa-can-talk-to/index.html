<!DOCTYPE html>
<html lang="en">
<head>
		<title>as days pass by &mdash; A software Matter device that Alexa can talk to</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="profile" href="http://gmpg.org/xfn/11" />
		<link href="https://fonts.googleapis.com/css?display=swap&family=Averia+Serif+Libre|Enriqueta:400,700" rel="stylesheet">
		<meta name="monetization" content="$pay.stronghold.co/1a198b49b9914f84e218d360b725bca1fd1">
		<meta name="Description" content="Stuart Langridge of Kryogenix Consulting, for consultancy and custom development on the web and devices">
        <meta property="og:title" content="as days pass by &mdash; A software Matter device that Alexa can talk to">
        <meta property="og:type" content="website">
        <meta property="og:site_name" content="as days pass by">
        <meta property="og:description" content="A post by Stuart Langridge (sil)">
        <meta property="og:image" content="https://www.kryogenix.org/days/2023/10/05/a-software-matter-device-that-alexa-can-talk-to/index.html.og_image.png">
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:site" content="@sil">
        <meta name="twitter:image" content="https://www.kryogenix.org/days/2023/10/05/a-software-matter-device-that-alexa-can-talk-to/index.html.og_image.png">
		<link rel="stylesheet" type="text/css" href="https://www.kryogenix.org/days/theme/css/style.css" />
		<link rel="stylesheet" type="text/css" href="https://www.kryogenix.org/days/theme/css/simple-footnotes.css" />
		<link rel="icon" type="image/png" href="/favicon.png" />
		<style type="text/css">
			body.custom-background {
				background: url(https://www.kryogenix.org/days/theme/handmadepaper.png); /* thank you subtlepatterns! */
			}
		</style>
		<link rel="alternate" type="application/rss+xml"
			title="as days pass by"
			href="https://www.kryogenix.org/days/feed" /> 
		<!--[if lte IE 8]><script src="https://www.kryogenix.org/days/theme/js/html5shiv.js"></script><![endif]-->
		<link rel="webmention" href="https://webmention.herokuapp.com/api/webmention" />
		<link rel="feed" href="https://www.kryogenix.org/days/archives/"> 
		<script src="https://cdn.ravenjs.com/3.4.1/raven.min.js"></script>
		<script>Raven.config('https://fc8cd4c9637043f3b385d9daa8dbe367@app.getsentry.com/91852').install()</script>
</head>

<body class="home blog custom-background single-author" >
	<div id="container">
		<div id="header">
				<p>A blog by <a href="https://www.kryogenix.org/">Stuart Langridge</a></p>
				<h1 id="site-title"><a href="https://www.kryogenix.org/days">as days pass by</a></h1>
<h2 id="site-description">scratched tallies on the prison wall</h2>		</div><!-- /#banner -->
		
		<div id="menu">
			<div class="menu-navigation-container">
				<ul id="menu-navigation" class="menu">
						<li  class="active" class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/">Kryogenix Consulting</a></li>
						<li  class="active" class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/days/archives">All posts, ever</a></li>
						<li  class="active" class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/code">Code</a></li>

				</ul>
			</div> <!--/#menu-navigation-container-->
		</div><!-- /#menu -->
		
		<div class="page-title">
		</div>
	
		<div id="contents">

<div class="post type-post status-publish format-standard hentry category-general h-entry" id="post">
	<div class="entry-meta">
		<div class="date"><a href="https://www.kryogenix.org/days/2023/10/05/a-software-matter-device-that-alexa-can-talk-to/"><time 
			class="dt-published" datetime="2023-10-05T09:44:00+01:00">Oct 05 2023</time></a>
			<span class="byline h-card">By <a class="p-author" href="https://www.kryogenix.org/days/"><img src="https://kryogenix.org/images/hackergotchi-simpler.png" class="u-photo" alt=""> <span class="p-name">sil</span></a></span>
		</div>
	</div> <!-- /#entry-meta -->
	<div class="main">
		<h2 class="entry-title">
			<a class="u-url p-name" href="https://www.kryogenix.org/days/2023/10/05/a-software-matter-device-that-alexa-can-talk-to/" title="Permalink to A software Matter device that Alexa can talk to" rel="bookmark">A software Matter device that Alexa can talk&nbsp;to</a>
		</h2>
		<div class="entry-content e-content">
			<blockquote cite="https://en.wikipedia.org/wiki/Shaddap_You_Face?useskin=vector">What’s-a matter you? Hey!<br>
Gotta no respect?<br>
What-a you t’ink you do, why you look-a so sad?<br>
It’s-a not so bad, it’s-a nice-a place
    <footer><cite>Shaddap Your Face, Joe Dolce</cite></footer>
</blockquote>

<p>(If you just want to know about how to make your own Matter device in software and don’t want to read a whole story to get to that point, then first of all that’s, I mean, that’s <em>fine</em>, it’s not a problem, you go ahead, I’m not hurt at <em>all</em>, definitely not, and secondly skip down to <a href="#matterpart4">Part 4</a> or check out the <a href="https://github.com/stuartlangridge/simple-js-matter-device">Github repo</a>. But, I mean, really? You’re that busy? You might wanna find a way to chill out a bit. Have a cup of tea. Enjoy life. It’s better, I promise.)</p>
<h1>Part the first: the kingdom of the blind</h1>
<p>I’ve got new window blinds in my flat. They’re pretty cool; ivory and purple, we’re all very pleased. They’re from Hillarys, who don’t get a link because although the actual blinds are great, their customer service is… less so, so I’m loath to recommend them. But one of the neat things about them is that they’re electrically operated. There’s a remote control; press the up or down button and they go up and down. Some people would be like a fascinated small child with this technology and spend half of the first day just pressing the buttons and giggling, but not me, no no.</p>
<p><img alt="A white room interior with a window covered by a day-night blind in a deep purple. The blind is alternating horizontal strips of deep purple fabric with a light texture, and almost-transparent white muslin. The room interior looks like a show home, because it probably is; the image is taken from Hillarys' website rather than being of my flat" src="https://kryogenix.org/images/purple-blinds-hillarys.jpg"></p>
<p>One of the questions I was asked when speccing them out was: do you want them to be controllable by Alexa? And I thought: well, yes, I would like that. Being able to command my blinds to open or close is one more step on the quest to be a James Bond villain. All I need after that is a monorail and a big picture on the wall which revolves to show my world domination map and I’m golden.</p>
<p>But… I do not like or trust the IoT industry. I’m not entirely against the whole concept — I mean, I <em>have</em> an Amazon Echo, after all. It gets used for cooking timers, my shopping list, and music<sup id="sf-a-software-matter-device-that-alexa-can-talk-to-1-back"><a href="#sf-a-software-matter-device-that-alexa-can-talk-to-1" class="simple-footnote" title="less so music than before, after the bloody shysters at Amazon decided to take away the free music playing from Amazon Prime and make people pay extra for it">1</a></sup>, but it doesn’t get used for IoT stuff because I don’t have any. This is, basically, because the whole IoT industry is full of grifters and thieves and I do not trust them with my data or with still being around in two years. The whole idea that I speak to a thing in my flat, that thing routes my command up to some server run by an IoT vendor, and then the IoT vendor’s server speaks to another thing in my flat to make it do work… this is a stupid plan. It’s the vendor forcibly inserting themselves as a middle man for literally no reason other than to exploit me later. Because they’ll get bored or bought in a few years and they’ll shut down the servers, with a sorry-not-sorry email about how it’s “no longer viable to support” a thing I paid for and therefore they’re turning it into a brick, but I can buy a replacement for the low low cost of… anyway, I’m not doing it. No. I don’t want some random vendor’s server to punch a hole into my internal network, I don’t want my stuff to stop working if they turn their servers off or they go down, and the whole concept is hugely irritating.</p>
<p><img alt='A tweet from j_opdenakker reading "the S in IoT stands for Security' src="https://kryogenix.org/images/s-in-iot.png"></p>
<p>(You might be thinking: why do you have an Echo at all, then? That’s got all the same problems! And you’re not wrong. But I trust Amazon to still be around for a while. Trusting them with my data is another thing, of course, but I’m already on board with that… although I entirely sympathise with people who choose to not do so either from distrust or from objections to their crappy employment or sales practices.)</p>
<p>Anyway, I looked up these blinds and the Alexa integration they do comes via a company called <a href="https://www.somfy.co.uk/products/electric-blinds">Somfy</a>. Their APIs seem semi-reasonably documented and I’ve heard nothing specifically bad about them as a company… but I still don’t like the idea. If I were <a href="https://mjg59.dreamwidth.org/">Matthew Garrett</a> then I would probably find joy in reverse-engineering whatever the protocol is and making it work for me, but I’m not as clever as he is<sup id="sf-a-software-matter-device-that-alexa-can-talk-to-2-back"><a href="#sf-a-software-matter-device-that-alexa-can-talk-to-2" class="simple-footnote" title="I make up for it by being, like, twice his size, though">2</a></sup>. And they’ll get bored or bought: I’m not sure I trust them to keep their servers running for years and years. Maybe I’d be <span class="caps">OK</span> with a thing that required an internet connection to someone else’s server and only let me fiddle with that to the extent that I am given <em>permission</em> for<sup id="sf-a-software-matter-device-that-alexa-can-talk-to-3-back"><a href="#sf-a-software-matter-device-that-alexa-can-talk-to-3" class="simple-footnote" title="honestly, this is the big issue. I react very badly to stuff where I ought to be able to do a thing and I’m not permitted to do so because they don’t want me to or can’t be bothered to implement it, and won’t let me do it myself. This is one of the big things that makes me move away from iOS every few years">3</a></sup>, if I’d only expect to keep that thing for a short time, but these are window blinds. How often do you change <em>your</em> window blinds? I expect these will still be here in twenty years! Do I expect these servers to also be there that long? Hell no. So, I’m not doing that.</p>
<h1>Part the second: keep government local</h1>
<p>I do actually have one “IoT” device in my flat, though. It’s a remotely-controllable wall socket. It’s from a company called <a href="https://www.mylocalbytes.com/">LocalBytes</a>, and it’s basically a “smart plug”: it’s a cylinder that plugs into a wall socket, and has another socket on the other side of it, rather like one of those mini gangplug cube things. </p>
<p><img alt="A LocalBytes smart plug, as described, plugged into a wall socket" src="https://kryogenix.org/images/localbytes-smart-plug.jpg"></p>
<p>It contains a little microcontroller and wifi chip, and it runs software called <a href="https://tasmota.github.io/docs/">Tasmota</a>. And it’s entirely locally controlled; you get a Tasmota app (or talk the documented protocol yourself from code) which can send the plug a command to turn on and off (and also a bunch more complex stuff such as turning on at a specific time), and it involves no internet servers at all. I can’t get screwed by you turning off your servers (or failing to secure them properly) if there aren’t any<sup id="sf-a-software-matter-device-that-alexa-can-talk-to-4-back"><a href="#sf-a-software-matter-device-that-alexa-can-talk-to-4" class="simple-footnote" title="insert picture here of that bloke tapping his temple knowingly">4</a></sup>. Now, I would not recommend these Tasmota devices to a normal person; the app is unreliable and pretends it can’t find the device some of the time, and the configuration <span class="caps">API</span> is obscure and weird. But I am, as has been said by kings and queens, not a normal person. I’m a computer bloke. So I am <span class="caps">OK</span> with this, and I’d be <span class="caps">OK</span> with something similar to control my blinds; something that runs locally and accepts commands from Alexa and then talks to the blinds to open and close them.</p>
<p>Now, the bit that actually talks to the blinds, I haven’t started working on yet. As far as I can tell from reading, the remote control works on a standard <a href="https://en.wikipedia.org/wiki/LPD433">“smart home” frequency of 433MHz</a>, and there are loads of little dongles and boards that plug into <span class="caps">USB</span> or Raspberry Pi <span class="caps">GPIO</span> pins which can talk that. I’ll get to that eventually; once I have a working thing, making it talk 433MHz is step 2. Step 1 is to make something that I control and which Alexa can talk to, but which <em>doesn’t</em> require servers on the internet to make it work. This rules out writing a custom Alexa skill; I can do that, and have, but you can’t write a skill which makes the actual Echo in my flat do network connections. The connection comes from Amazon’s servers, which means I’d have to put my little device on the internet, which I don’t want to do. The concern of the servers going away doesn’t apply here — if Amazon’s servers go away, my Echo stops working anyway and all of this is moot — but I do not want to punch a hole into my internal network from outside, and I shouldn’t have to. This is one thing in my house talking to another thing in my house. </p>
<p>This problem used to be unsolvable. And then, just like in the beginning of all things, someone invented <a href="https://csa-iot.org/all-solutions/matter/">Matter</a>.</p>
<h1>Part the third: does it Matter?</h1>
<p>It is, obviously, stupid that every device invents its own protocol to talk to it, and none of it’s documented, and none of it’s standardised, and everything gets reinvented from scratch by programmers who clearly have their minds on lunchtime. So, equally obviously, the way to solve this is to have all the biggest tech companies in the world collaboratively agree on a standard way to do things.</p>
<p>I can hear you laughing from here.</p>
<p>This has, equally equally obviously, resulted in a disastrous nine-way collision of corporate speak, absurd specifications, paywalls for things, requirements to sign up as a “partner” before you’re told anything, and documentation by press release. But to my surprise it has actually resulted in something! The Matter specifications have basically everybody on board — Amazon, Apple, Google, most of the big players in the device world — and have finally started to actually appear in real shipping products rather than only in conference talks. The Amazon Echo supports Matter back to the 3rd gen Dot (there’s a <a href="https://www.amazon.co.uk/b?ie=UTF8&amp;node=63710514031">list of Matter-supporting Echo devices here</a>). If you’ve got a Matter-supporting thingy, then it’ll have the Matter logo on it:</p>
<p>![The Matter logo: three arrows with curved heads all pointing into a single central point; it has threefold symmetry like the radiation symbol and similar things. It also has the word “matter” in a curvy slightly childish font]</p>
<p>and then you can say “Alexa, discover devices” and your Echo will search and then say “I have found a Matter device!”. You then use the Alexa app on your phone to pair it, either by scanning a <span class="caps">QR</span> code or typing in a code, both of which should be on the device itself.</p>
<p>Now, Matter is a big corporate spec and wants to deal with all sorts of complicated and detailed edge cases. In particular, there is a standard problem with an IoT device in your house, which is that you can’t talk to it until it’s on the wifi, but you can’t put it on the wifi without talking to it. This normally involves the device pretending to be a wifi access point, and you connecting to it with a mobile app you have to install<sup id="sf-a-software-matter-device-that-alexa-can-talk-to-5-back"><a href="#sf-a-software-matter-device-that-alexa-can-talk-to-5" class="simple-footnote" title="you should not need a mobile app to connect to a device pretending to be an access point. You should be able to do this from the web browser on your phone. But you can’t, as I have laboriously discussed before in these pages and am still annoyed about">5</a></sup>, but Matter attempts to improve this; a Matter device can potentially exchange data over wifi, over Bluetooth, over some extra network thing called Thread that I don’t understand, over ethernet, the works. A lot of the setup and spec for Matter involves dealing with all this.</p>
<p>I, personally, for myself, for this device, do not care about this. If I were making a device that would be sold to real people, I’d implement all this stuff. But since it’s just me, I’m <span class="caps">OK</span> with requiring that my window blind device is <em>already</em> on my wifi, and getting it that way is my problem, <em>before</em> I try detecting it with Alexa.</p>
<p>So, I need a way to make a Matter device; it only has to deal with wifi. The Matter specification<sup id="sf-a-software-matter-device-that-alexa-can-talk-to-6-back"><a href="#sf-a-software-matter-device-that-alexa-can-talk-to-6" class="simple-footnote" title="as usual with corporate technology things, the Matter specification is difficult to find; one of these things where you need to sign up, or be a “partner”, or pay money, or something. But it is obtainable. The Alexa Matter docs link to a page on the Matter website which lets you fill in an email address and then emails you a link to  in all its 895 page glory">6</a></sup> describes how to talk Matter, but there’s a lot of detail in there. Surely someone has already implemented this stuff?</p>
<p>Well, they have… but it’s not great. The <a href="https://github.com/project-chip/connectedhomeip">@project-chip/connectedhomeip</a> Github repository, named back in the days when Matter was still called “project <span class="caps">CHIP</span>” before the Branding People got their hands on it, is the reference implementation. And it’s a nightmare. It’s all in C, it’s <em>huge</em> (I checked out the repo and all its submodules and ran out of disk space; to get the repo and all sub-repos and then build it, you’d better have <span class="caps">30GB</span> or so free), compiling it all is a massive headache, it contains code for all sorts of different single-board computers to make them Matter devices, and I couldn’t make head nor tail of it. I’m sure you need all this if you’re looking to build a device and ship millions of them to people in Best Buy and Currys, but I ain’t. Normally, people write stuff like this in Python, but in looking around all I could find was a <a href="https://github.com/home-assistant-libs/python-matter-server">Python library</a> designed to work with <a href="https://www.home-assistant.io/">Home Assistant</a>, which is not what I wanted (I want to make a device, not a controller) and which required the <span class="caps">CHIP</span> <span class="caps">SDK</span> anyway, the big complicated nightmare thing mentioned above. I resigned myself to having to write a very noddy implementation of enough of Matter’s pairing and communications stuff in Python to get a device up and running, and bitched about having to do this on social media. And then <a href="https://mastodon.ie/@AlanBell">Alan Bell</a>, hero of the revolution, said: have you tried <a href="https://github.com/project-chip/matter.js">matter.js</a>?<sup id="sf-a-software-matter-device-that-alexa-can-talk-to-7-back"><a href="#sf-a-software-matter-device-that-alexa-can-talk-to-7" class="simple-footnote" title="There is an unfortunate naming collision here. There already was a Matter.js: it’s a 2d physics engine for the web, which I’ve used before. But I can’t see what else the people implementing the Matter spec in JavaScript could have called their thing. Only so many words in the world, I guess">7</a></sup></p>
<p>I had not. So I gave it a look.</p>
<h1 id="matterpart4">Part the fourth: yes it Matters!</h1>
<p><a href="https://github.com/project-chip/matter.js">Matter.js</a> is an implementation of the Matter suite of protocols in JavaScript. It does not build on the huge complicated Project <span class="caps">CHIP</span> <span class="caps">SDK</span>; it’s its own thing. And it just works.</p>
<p>If you want to build a Matter device in JavaScript, take a look at <a href="https://github.com/project-chip/matter.js/blob/main/packages/matter-node.js-examples/README.md">the Matter.js Node examples</a> and they work fine. You can do that right now.</p>
<p>I did something a little tiny bit different. The Matter.js stuff is not actually <span class="caps">JS</span>; it’s TypeScript. I don’t like TypeScript<sup id="sf-a-software-matter-device-that-alexa-can-talk-to-8-back"><a href="#sf-a-software-matter-device-that-alexa-can-talk-to-8" class="simple-footnote" title="feel free to email your long diatribe about why TypeScript is the future to IDontCare@Whatever.Bored">8</a></sup> and so I wanted a plain <span class="caps">JS</span> thing. So I did a simple reimplementation of the simplest Matter.js example in plain <span class="caps">JS</span>, and made it even simpler; the original correctly lets you pass in a bunch of details on the command line to configure it, but I’m not bothered about that and wanted to keep it as simple as possible. So, <a href="https://github.com/stuartlangridge/simple-js-matter-device">the simplest possible “virtual” Matter device implemented in JavaScript</a>. It’s a lightbulb; Alexa, and Matter, do support multiple types of devices (including window blind controllers!) but Matter.js only does lightbulbs and sockets at the moment. I’m probably going to build and contribute the window blind controller device type, if someone else doesn’t get there first. Anyway, let’s get this code running! Use is pretty easy for a developer:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/stuartlangridge/simple-js-matter-device.git
Cloning<span class="w"> </span>into<span class="w"> </span><span class="s1">'simple-js-matter-device'</span>...
remote:<span class="w"> </span>Enumerating<span class="w"> </span>objects:<span class="w"> </span><span class="m">11</span>,<span class="w"> </span><span class="k">done</span>.
remote:<span class="w"> </span>Counting<span class="w"> </span>objects:<span class="w"> </span><span class="m">100</span>%<span class="w"> </span><span class="o">(</span><span class="m">11</span>/11<span class="o">)</span>,<span class="w"> </span><span class="k">done</span>.
remote:<span class="w"> </span>Compressing<span class="w"> </span>objects:<span class="w"> </span><span class="m">100</span>%<span class="w"> </span><span class="o">(</span><span class="m">10</span>/10<span class="o">)</span>,<span class="w"> </span><span class="k">done</span>.
remote:<span class="w"> </span>Total<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="o">(</span>delta<span class="w"> </span><span class="m">0</span><span class="o">)</span>,<span class="w"> </span>reused<span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="o">(</span>delta<span class="w"> </span><span class="m">0</span><span class="o">)</span>,<span class="w"> </span>pack-reused<span class="w"> </span><span class="m">0</span>
Receiving<span class="w"> </span>objects:<span class="w"> </span><span class="m">100</span>%<span class="w"> </span><span class="o">(</span><span class="m">11</span>/11<span class="o">)</span>,<span class="w"> </span><span class="m">25</span>.16<span class="w"> </span>KiB<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">1</span>.48<span class="w"> </span>MiB/s,<span class="w"> </span><span class="k">done</span>.
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>simple-js-matter-device
$<span class="w"> </span>npm<span class="w"> </span>install

added<span class="w"> </span><span class="m">90</span><span class="w"> </span>packages,<span class="w"> </span>and<span class="w"> </span>audited<span class="w"> </span><span class="m">91</span><span class="w"> </span>packages<span class="w"> </span><span class="k">in</span><span class="w"> </span>5s

<span class="m">5</span><span class="w"> </span>packages<span class="w"> </span>are<span class="w"> </span>looking<span class="w"> </span><span class="k">for</span><span class="w"> </span>funding
<span class="w">  </span>run<span class="w"> </span><span class="sb">`</span>npm<span class="w"> </span>fund<span class="sb">`</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>details

found<span class="w"> </span><span class="m">0</span><span class="w"> </span>vulnerabilities
$<span class="w"> </span>node<span class="w"> </span>sil.mjs<span class="w"> </span>
<span class="m">2023</span>-10-06<span class="w"> </span><span class="m">11</span>:38:24.231<span class="w"> </span>INFO<span class="w">  </span>Device<span class="w">               </span>node-matter
▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄
█<span class="w"> </span>▄▄▄▄▄<span class="w"> </span>██▀▄▀▄█<span class="w"> </span>▄▄▄▄▄<span class="w"> </span>█
█<span class="w"> </span>█<span class="w">   </span>█<span class="w"> </span>█▄▀▄▀▄█<span class="w"> </span>█<span class="w">   </span>█<span class="w"> </span>█
█<span class="w"> </span>█▄▄▄█<span class="w"> </span>██<span class="w"> </span>▀▀▄█<span class="w"> </span>█▄▄▄█<span class="w"> </span>█
█▄▄▄▄▄▄▄█<span class="w"> </span>█<span class="w"> </span>▀▄█▄▄▄▄▄▄▄█
█<span class="w"> </span>▄<span class="w"> </span>█▄<span class="w"> </span>▄▄▄█<span class="w"> </span>█<span class="w">  </span>▄▀██<span class="w"> </span>█▀█
██▀<span class="w">  </span>█▀▄█▄<span class="w"> </span>█<span class="w"> </span>▀▀▄█<span class="w">  </span>▀█▀█
██▄█▄▄█▄▄█▄▄▀<span class="w"> </span>▀▄<span class="w"> </span>█▄▀▄▀█
█<span class="w"> </span>▄▄▄▄▄<span class="w"> </span>█<span class="w">  </span>▄█▄█▄▄<span class="w"> </span>▄<span class="w"> </span>█<span class="w"> </span>█
█<span class="w"> </span>█<span class="w">   </span>█<span class="w"> </span>█▄▄<span class="w"> </span>█▄<span class="w"> </span>▄<span class="w"> </span>▀▄<span class="w"> </span>▀██
█<span class="w"> </span>█▄▄▄█<span class="w"> </span>█<span class="w">  </span>▀█▄█<span class="w"> </span>▀█<span class="w">  </span>▀<span class="w"> </span>█
█▄▄▄▄▄▄▄█▄███▄██▄██▄█▄█
▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀

<span class="m">2023</span>-10-06<span class="w"> </span><span class="m">11</span>:38:24.330<span class="w"> </span>INFO<span class="w">  </span>Device<span class="w">               </span>QR<span class="w"> </span>Code<span class="w"> </span>URL:<span class="w"> </span>https://project-chip.github.io/connectedhomeip/qrcode.html?data<span class="o">=</span>MT:Y.K90-Q000KA0648G00
<span class="m">2023</span>-10-06<span class="w"> </span><span class="m">11</span>:38:24.330<span class="w"> </span>INFO<span class="w">  </span>Device<span class="w">               </span>Manual<span class="w"> </span>pairing<span class="w"> </span>code:<span class="w"> </span><span class="m">34970112332</span>
</code></pre></div>

<p>We’ve git cloned the repository, done <code>npm install</code> to install the dependencies, and run it. That starts up our virtual device, and also prints the <span class="caps">QR</span> code and manual pairing code used for pairing. Job done; your device now exists.</p>
<p>Next, we teach Alexa about it. Exercise your most commanding voice and say “Alexa, discover new devices!” Your Echo will tell you it’s doing it, and then after a few seconds of searching, tell you that it’s found one Matter device and send you off to the devices section of the Alexa app on your phone to connect it up; I also got a notification on my phone telling me the same thing.</p>
<p><img alt='an iOS lock screen showing a notification reading "Tap to begin setup with Alexa: New Matter Device found' src="https://kryogenix.org/images/matter-ios-shots/01-notification.png"></p>
<p>Hit that notification and you end up on the Devices screen, where it’ll tell you to “Connect your Matter Light Bulb”:</p>
<p><img alt="the Alexa app's Devices screen, with &quot;Connect your Matter Light Bulb&quot; in a newly showing &quot;Available Devices&quot; section" src="https://kryogenix.org/images/matter-ios-shots/02-devices.png"></p>
<p>(For some reason, my device seems to present as two separate devices; a light bulb and an unnamed “Matter device”. I don’t know why. It seems that you can pick either.)</p>
<p>Choose to connect to this Matter device, and you get a screen called “Control your Matter device with Alexa”, which is exactly what we want to do:</p>
<p><img alt='the Alexa app showing a screen headlined "Control your Matter device with Alexa", and Cancel and Next buttons' src="https://kryogenix.org/images/matter-ios-shots/03-control.png"></p>
<p>When asked if your device has a Matter logo, say yes (it would do if it were a real Matter device, of course):</p>
<p><img alt='the Alexa app showing a screen headlined "Does your device have a Matter logo?", and No and Yes buttons' src="https://kryogenix.org/images/matter-ios-shots/04-logo.png"></p>
<p>Then you have to scan the <span class="caps">QR</span> code. Usefully, the device has printed out a <span class="caps">QR</span> code in the Terminal where you ran it, above; scan that. If that didn’t work for some reason, it has also printed a <span class="caps">URL</span> for that <span class="caps">QR</span> code which you can follow to show the <span class="caps">QR</span> in the browser, and if that doesn’t work either, you can enter the numeric code it printed (the “manual pairing code) instead:</p>
<p><img alt='the Alexa app showing a screen headlined "Locate a QR code shown for your device", and "Try numeric code instead?" and "Scan QR code" buttons' src="https://kryogenix.org/images/matter-ios-shots/05-qr.png"></p>
<p>Alexa will then claim to be “Looking for your device” (and the stuff in the Terminal will print a bunch of logging things about “Pase server: Received pairing request from udp://192.168.1.103:5541” and whatnot):</p>
<p><img alt='the Alexa app showing a screen headlined "Looking for your device", and a waiting spinner' src="https://kryogenix.org/images/matter-ios-shots/06-looking.png"></p>
<p>and then, all else being good, you’ll get a screen telling you your light is connected! It’s called “Kryogenix Light” in this screen, and “Stuart Light” elsewhere; you can see those strings in <code>sil.mjs</code> and can customise them to your heart’s content.</p>
<p><img alt='the Alexa app showing a screen headlined "Kryogenix Light found and connected", and a Next button' src="https://kryogenix.org/images/matter-ios-shots/07-connected.png"></p>
<p>You should now have a “Lights” section in the Devices screen of your Alexa app. You can use this to turn the “light” on and off from the Alexa app, or you can say “Alexa, turn Stuart Light on” to do it by voice. When you do that, the Terminal should print <code>!!!!!!!!!!!!!!!! GOT COMMAND true</code> (or <code>false</code>), which means it’s calling the <code>onOffListener</code> we <a href="https://github.com/stuartlangridge/simple-js-matter-device/blob/56e4d964c1f1fc5ff9164292bca3b20cea262d5f/sil.mjs#L45">defined in sil.mjs</a>. You can customise this to do whatever you’d like!</p>
<p><img alt='the Alexa app showing a screen headlined "Stuart Light", and a big circular on/off power button, currently set to On with a blue halo around it' src="https://kryogenix.org/images/matter-ios-shots/08-onoff.png"></p>
<p>And that’s it working. That’s a software device, which you can pair with Alexa and customise how you choose; it doesn’t require you to write an Alexa skill, and the device does not need to be accessible from the internet. That’s just what I want.</p>
<p>Now I suppose I have to make it do something useful…</p><ol class="simple-footnotes"><li id="sf-a-software-matter-device-that-alexa-can-talk-to-1">less so music than before, after the bloody shysters at Amazon decided to take away the free music playing from Amazon Prime and make people pay extra for it <a href="#sf-a-software-matter-device-that-alexa-can-talk-to-1-back" class="simple-footnote-back">↩</a></li><li id="sf-a-software-matter-device-that-alexa-can-talk-to-2">I make up for it by being, like, twice his size, though <a href="#sf-a-software-matter-device-that-alexa-can-talk-to-2-back" class="simple-footnote-back">↩</a></li><li id="sf-a-software-matter-device-that-alexa-can-talk-to-3">honestly, this is the big issue. I react very badly to stuff where I <em>ought</em> to be able to do a thing and I’m not permitted to do so because they don’t want me to or can’t be bothered to implement it, and won’t let me do it myself. This is one of the big things that makes me move away from iOS every few years <a href="#sf-a-software-matter-device-that-alexa-can-talk-to-3-back" class="simple-footnote-back">↩</a></li><li id="sf-a-software-matter-device-that-alexa-can-talk-to-4">insert picture here of that bloke tapping his temple knowingly <a href="#sf-a-software-matter-device-that-alexa-can-talk-to-4-back" class="simple-footnote-back">↩</a></li><li id="sf-a-software-matter-device-that-alexa-can-talk-to-5">you should not need a mobile app to connect to a device pretending to be an access point. You should be able to do this from the web browser on your phone. But you can’t, as <a href="https://www.kryogenix.org/days/2020/08/18/iot-devices-and-android-and-disappointment/">I have laboriously discussed before in these pages</a> and am still annoyed about <a href="#sf-a-software-matter-device-that-alexa-can-talk-to-5-back" class="simple-footnote-back">↩</a></li><li id="sf-a-software-matter-device-that-alexa-can-talk-to-6">as usual with corporate technology things, the Matter specification is difficult to find; one of these things where you need to sign up, or be a “partner”, or pay money, or something. But it is obtainable. <a href="https://developer.amazon.com/en-US/docs/alexa/smarthome/matter-support.html">The Alexa Matter docs</a> link to <a href="https://csa-iot.org/developer-resource/specifications-download-request/">a page on the Matter website</a> which lets you fill in an email address and then emails you a link to <a href="https://csa-iot.org/wp-content/uploads/2022/11/22-27349-001_Matter-1.0-Core-Specification.pdf">a <span class="caps">PDF</span> of the spec</a> in all its 895 page glory <a href="#sf-a-software-matter-device-that-alexa-can-talk-to-6-back" class="simple-footnote-back">↩</a></li><li id="sf-a-software-matter-device-that-alexa-can-talk-to-7">There is an unfortunate naming collision here. There already was a <a href="https://brm.io/matter-js/">Matter.js</a>: it’s a 2d physics engine for the web, which I’ve used before. But I can’t see what else the people implementing the Matter spec in JavaScript could have called their thing. Only so many words in the world, I guess <a href="#sf-a-software-matter-device-that-alexa-can-talk-to-7-back" class="simple-footnote-back">↩</a></li><li id="sf-a-software-matter-device-that-alexa-can-talk-to-8">feel free to email your long diatribe about why TypeScript is the future to IDontCare@Whatever.Bored <a href="#sf-a-software-matter-device-that-alexa-can-talk-to-8-back" class="simple-footnote-back">↩</a></li></ol>
		</div> <!--/#entry-content-->
		<ul class="neighbours-links">
		<li><a href="https://www.kryogenix.org/days/2023/08/06/numeric-pangrams/">Previous post</a></li>
		</ul>

		<div class="hireme">
			I'm currently available for hire, to help you plan, architect, and build new systems, and for technical writing
			and articles. You can take a look at <a href="https://kryogenix.org">some projects I've worked on</a> and
			<a href="https://kryogenix.org/books">some of my writing</a>. If you'd like to talk about your upcoming project,
			do <a href="https://kryogenix.org/contact">get in touch.</a>
		</div>
	</div> <!--/#main-->
</div>  <!--/#post-->
<div id="webmentions">
<h4>More in the discussion (powered by <a href="http://indiewebcamp.com/Webmention">webmentions</a>)</h4>
	<ul><li>(no mentions, yet.)</li></ul>
<form id="wmform" method="POST" action="https://webmention.herokuapp.com/api/webmention">
	<label>Did you link to this post? Enter your page's URL:
	<input type="url" name="source"></label>
	<input type="hidden" name="target" value="https://www.kryogenix.org/days/2023/10/05/a-software-matter-device-that-alexa-can-talk-to/">
	<input type="submit" value="Add link">
</form>
<script src="https://www.kryogenix.org/days/theme/live-webmentions-cors.js"></script>
</div>

<p id="oldcomments"></p>
<script>
var aurl = '2023/10/05/a-software-matter-device-that-alexa-can-talk-to/';
var parts = aurl.split('/');
if (parts[parts.length-1] === "") { parts = parts.slice(0, parts.length-1); }
var tooNewForOldComments = false;
if (parts[0].match(/^[0-9]+$/)) {
	var asnum = parseInt(parts[0], 10);
	if (!isNaN(asnum) && asnum > 2014) {
		tooNewForOldComments = true;
	}
}
if (!tooNewForOldComments) {
	var comurl = "/oldcomments/" + parts.join("-") + ".html";
	var x = new XMLHttpRequest();
	x.open("HEAD", comurl, true);
	x.onreadystatechange = function() {
		if (x.readyState == 4) {
			if (x.status == 200) {
				document.getElementById("oldcomments").innerHTML = '<a href="' + comurl + '">See pre-2014 comments on this post</a>';
			}
		}
	};
	x.send();
}
</script>
<script type="module">
/* jslint esversion: 11 */
try {
	const resp = await fetch("/adpb-popular.json");
	const vals = await resp.json();
	let popular = vals[location.pathname];
	if (!popular && location.pathname.endsWith("/")) {
		popular = vals[location.pathname.replace(/\/$/, "")];
	}
	if (popular && popular.recent_idx != null) {
		let a = document.createElement("a");
		let p = document.createElement("p");
		p.className = "trending";
		a.href = "/adpb-popular.html";
		a.append(`#${popular.recent_idx + 1} in Trending`);
		p.append(a);
		const ec = document.querySelector("div.entry-content");
		ec.insertBefore(p, ec.firstChild);
	}
} catch(e) {
	console.error("Failed to fetch popular list", e);
}
</script>

		</div>
		
		<div id="footer">
			<p>Powered by <a href="http://pelican.readthedocs.org">Pelican</a>, theme by <a href="http://bunnyman.info">tBunnyMan</a>.</p>
			<script src="https://the-claw-webring-widget.netlify.app/the-claw-webring-widget.mjs" type="module"></script>
			<the-claw-webring-widget />
			<!-- Global site tag (gtag.js) - Google Analytics. Cookie set to be a session cookie, not permanent, for privacy
			https://developers.google.com/analytics/devguides/collection/gtagjs/cookies-user-id#cookie_expiration -->
			<script async src="https://www.googletagmanager.com/gtag/js?id=UA-331575-1"></script>
			<script>
  				window.dataLayer = window.dataLayer || [];
  				function gtag(){dataLayer.push(arguments);}
  				gtag('js', new Date());
  				gtag('config', 'UA-331575-1', {cookie_expires: 0});
			</script>
		</div><!-- /#footer -->
	</div><!-- /#container -->




<div id="loadtimer"></div>
<script>
window.onload = function(){
    setTimeout(function(){
      window.performance = window.performance || 
window.mozPerformance || window.msPerformance || 
window.webkitPerformance || {};
      var t = performance.timing || {};
      if (!t) {
        
        return;
      }
      var start = t.navigationStart,
          end = t.loadEventEnd
          loadTime = (end - start) / 1000;
      var copy = document.getElementById('loadtimer');
      copy.innerHTML += "This page loaded in " + loadTime + " seconds.";
    }, 0); 
}

</script>
</body> </html>