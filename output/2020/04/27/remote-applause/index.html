<!DOCTYPE html>
<html lang="en">
<head>
		<title>as days pass by &mdash; Remote¬†Applause</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="profile" href="http://gmpg.org/xfn/11" />
		<link href="https://fonts.googleapis.com/css?display=swap&family=Averia+Serif+Libre|Enriqueta:400,700" rel="stylesheet">
		<meta name="monetization" content="$pay.stronghold.co/1a198b49b9914f84e218d360b725bca1fd1">
		<meta name="Description" content="Stuart Langridge of Kryogenix Consulting, for consultancy and custom development on the web and devices">
        <meta property="og:title" content="as days pass by &mdash; Remote¬†Applause">
        <meta property="og:type" content="website">
        <meta property="og:site_name" content="as days pass by">
        <meta property="og:description" content="A post by Stuart Langridge (sil)">
        <meta property="og:image" content="https://www.kryogenix.org/days/2020/04/27/remote-applause/index.html.og_image.png">
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:site" content="@sil">
        <meta name="twitter:image" content="https://www.kryogenix.org/days/2020/04/27/remote-applause/index.html.og_image.png">
		<link rel="stylesheet" type="text/css" href="https://www.kryogenix.org/days/theme/css/style.css" />
		<link rel="stylesheet" type="text/css" href="https://www.kryogenix.org/days/theme/css/simple-footnotes.css" />
		<link rel="icon" type="image/png" href="/favicon.png" />
		<style type="text/css">
			body.custom-background {
				background: url(https://www.kryogenix.org/days/theme/handmadepaper.png); /* thank you subtlepatterns! */
			}
		</style>
		<link rel="alternate" type="application/rss+xml"
			title="as days pass by"
			href="https://www.kryogenix.org/days/feed" /> 
		<!--[if lte IE 8]><script src="https://www.kryogenix.org/days/theme/js/html5shiv.js"></script><![endif]-->
		<link rel="webmention" href="https://webmention.herokuapp.com/api/webmention" />
		<link rel="feed" href="https://www.kryogenix.org/days/archives/"> 
		<script src="https://cdn.ravenjs.com/3.4.1/raven.min.js"></script>
		<script>Raven.config('https://fc8cd4c9637043f3b385d9daa8dbe367@app.getsentry.com/91852').install()</script>
</head>

<body class="home blog custom-background single-author" >
	<div id="container">
		<div id="header">
				<p>A blog by <a href="https://www.kryogenix.org/">Stuart Langridge</a></p>
				<h1 id="site-title"><a href="https://www.kryogenix.org/days">as days pass by</a></h1>
<h2 id="site-description">scratched tallies on the prison wall</h2>		</div><!-- /#banner -->
		
		<div id="menu">
			<div class="menu-navigation-container">
				<ul id="menu-navigation" class="menu">
						<li  class="active" class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/">Kryogenix Consulting</a></li>
						<li  class="active" class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/days/archives">All posts, ever</a></li>
						<li  class="active" class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/code">Code</a></li>

				</ul>
			</div> <!--/#menu-navigation-container-->
		</div><!-- /#menu -->
		
		<div class="page-title">
		</div>
	
		<div id="contents">

<div class="post type-post status-publish format-standard hentry category-general h-entry" id="post">
	<div class="entry-meta">
		<div class="date"><a href="https://www.kryogenix.org/days/2020/04/27/remote-applause/"><time 
			class="dt-published" datetime="2020-04-27T20:31:00+01:00">Apr 27 2020</time></a>
			<span class="byline h-card">By <a class="p-author" href="https://www.kryogenix.org/days/"><img src="https://kryogenix.org/images/hackergotchi-simpler.png" class="u-photo" alt=""> <span class="p-name">sil</span></a></span>
		</div>
	</div> <!-- /#entry-meta -->
	<div class="main">
		<h2 class="entry-title">
			<a class="u-url p-name" href="https://www.kryogenix.org/days/2020/04/27/remote-applause/" title="Permalink to Remote¬†Applause" rel="bookmark">Remote&nbsp;Applause</a>
		</h2>
		<div class="entry-content e-content">
			<blockquote class="twitter-tweet"><p lang="en" dir="ltr">For online conferences, someone should make it so üëèüèª or üòÜ in the chat leads to the sound of claps and laughs on video. The audience feels like a missing piece of what makes conferences so special. (The more claps and laughs, the more clap and laugh track should be¬†played)</p>‚Äî Nicole Sullivan (@stubbornella) <a href="https://twitter.com/stubbornella/status/1254164566017114112?ref_src=twsrc%5Etfw">April 25, 2020</a></blockquote>

<p>That‚Äôs a cool idea, I¬†thought.</p>
<p>So I built <a href="https://stuartlangridge.github.io/remote-applause/">Remote Applause</a>, which does exactly that. Give your session a name, and it gives you a page to be the ‚Äústage‚Äù, and a link to send to everyone in the ‚Äúaudience‚Äù. The audience link has ‚Äúclap‚Äù and ‚Äúlaugh‚Äù buttons; when anyone presses one, your stage page plays the sound of a laughter track or applause. Quite neat for an afternoon hack, so I thought I‚Äôd talk about how it¬†works.</p>
<p><img alt="the Remote Applause audience page" src="https://kryogenix.org/images/rabanner.png"></p>
<p>Basically, it‚Äôs all driven by WebRTC data connections. WebRTC is notoriously difficult to get right, but fortunately <a href="https://peerjs.com/">PeerJS</a> exists which does most of the heavy lifting.<sup id="sf-remote-applause-1-back"><a href="#sf-remote-applause-1" class="simple-footnote" title="but it requires javascript! Aren‚Äôt you always going on about that, Stuart? Well, yes. However, it‚Äôs flat-out not possible to do real-time two-way communication sanely without it, so I‚Äôm OK with requiring JS in this particular case. For your restaurant menu, no.">1</a></sup> It seemed to be abandoned a few years ago, but they‚Äôve picked it up again since, which is good news. Essentially, the way the thing works is as¬†follows:</p>
<p>When you name your session, the ‚Äústage‚Äù page calculates a unique <span class="caps">ID</span> from that name, and registers with that name on PeerJS‚Äôs coordination server. The audience page calculates the same <span class="caps">ID</span><sup id="sf-remote-applause-2-back"><a href="#sf-remote-applause-2" class="simple-footnote" title="using a quick JS version of Java‚Äôs hashCode function, because PeerJS has requirements on ID strings that exclude some of the characters in base64 so I couldn‚Äôt use window.btoa(), I didn‚Äôt want (or need) a whole hash library, and the  is complex">2</a></sup>, registers itself with a random <span class="caps">ID</span>, and opens a PeerJS data connection to the stage page (because it knows what its <span class="caps">ID</span> is). PeerJS is just using WebRTC data connections under the covers, but the PeerJS people provide the signalling server, which the main alternative <a href="https://github.com/feross/simple-peer">simple-peer</a> doesn‚Äôt, and I didn‚Äôt want to have to run a signalling server myself because then I‚Äôd need server-side hosting for¬†it.</p>
<p>The audience page can then send a ‚Äúclap‚Äù or ‚Äúlaugh‚Äù message down that connection whenever the respective button is pressed, and the stage page receives that message and plays the appropriate sound. Well, it‚Äôs a fraction more complex than that. The two sounds, clapping and laughing, are constantly playing on a loop but muted. When the stage receives messages, it changes the volume on the sounds. Fortunately, the stage knows how many incoming connections there are, and it knows who the messages are coming in from, so it can scale the volume change appropriately; if most of the audience send a clap, then the stage can jack the clapping volume up to 100%, and if only a few people do then it can still play the clapping but at much lower volume. This largely does away with the need for moderation; a malicious actor who hammers the clap button as often as they can can at the very worst only make the applause track play at full volume, and most of the time they‚Äôll be one in 50 people and so can only make it play at 5% volume or¬†something.</p>
<p>There are a couple of extra wrinkles. The first one is that autoplaying sounds are a no-no, because of all the awful advertising people who misused them to have autoplaying videos as soon as you opened a page; sound can only start playing if it‚Äôs driven by a user gesture of some kind. So the stage has an ‚Äúenable sounds‚Äù checkbox; turning that checkbox on counts as the user gesture, so we can start actually playing the sounds but at zero volume, and we also take advantage of that to send a message to all the connected audience pages to tell them it‚Äôs enabled‚Ä¶ and the audience pages don‚Äôt show the buttons until they get that message, which is handy. The second thing is that when the stage receives a clap or laugh from an audience member it rebroadcasts that to all other audience members; this means that each audience page can show a little clap emoji when that happens, so you can see how many other people are clapping as well as hear it over the conference audio. And the third‚Ä¶ well, the third is a bit more¬†annoying.</p>
<p>If an audience member closes their page, the stage ought to get told about that somehow. And it does‚Ä¶ in Firefox. The PeerJS <code>connection</code> object fires a <code>close</code> event when this happens, so, hooray. In Chrome, though, we never get that event. As far as I can tell it‚Äôs a known bug in PeerJS, or possibly in Chrome‚Äôs WebRTC implementation; I didn‚Äôt manage to track it down further than the PeerJS issues list. So what we <em>also</em> do in the stage is poll the PeerJS connection object for every connection every few seconds with <code>setInterval</code>, because it exposes the underlying WebRTC connection object, and that does indeed have a property dictating its current state. So we check that and if it‚Äôs showing <code>disconnected</code>, we treat that the same as the <code>close</code> event. Easily enough¬†solved.</p>
<p>There are more complexities than that, though. WebRTC is pretty goshdarn flaky, in my experience. If the stage runner is using a lot of their bandwidth, then the connections to the stage drop, like, a <em>lot</em>, and need to be reconnected. I suppose it would be possible to quietly gloss over this in the <span class="caps">UI</span> and just save stuff up for when the connection comes back, but I didn‚Äôt do that, firstly because I <strong>hate</strong> it when an app pretends it‚Äôs working but actually it isn‚Äôt, and secondly because¬†of‚Ä¶</p>
<p><strong>Latency.</strong> This is the other big problem, and I don‚Äôt think it‚Äôs one that Remote Applause can fix, because it‚Äôs not <span class="caps">RA</span>‚Äôs problem. You see, the model for this is that I‚Äôm streaming myself giving a talk as part of an online conference, right? Now, testing has demonstrated that when doing this on Twitch or YouTube Live or whatever, there‚Äôs a delay of anything from 5 to 30 seconds or so in between me saying something and the audience hearing it. Anyone who‚Äôs tried interacting with the live chat while streaming will have experienced this. Normally that‚Äôs not all that big a problem (except for interacting with the live chat) but it‚Äôs definitely a problem for this, because even if Remote Applause is instantaneous (which it pretty much is), when you press the button to applaud, the speaker is 10 seconds further into their talk. So you‚Äôll be applauding the wrong thing. I‚Äôm not sure that‚Äôs fixable; it‚Äôs pretty much an inherent limitation of streaming video. Microsoft reputedly have a <a href="https://docs.microsoft.com/en-us/azure/media-services/latest/live-event-latency">low latency streaming video service</a> but most people aren‚Äôt using it; maybe Twitch and YouTube will adopt this¬†technology. </p>
<p>Still, it was a fun little project! Nice to have a reason to use PeerJS for something. And it‚Äôs <a href="https://stuartlangridge.github.io/remote-applause/">hosted on Github Pages</a> because it‚Äôs all client side, so it doesn‚Äôt cost me anything to run, which is nice and so I can just leave it up even if nobody‚Äôs using it. And I quite like the pictures, too; the stage page shows a view of an audience <em>from</em> the stage (specifically, <a href="https://en.wikipedia.org/wiki/Metropolitan_Opera_House_(39th_Street)">the old Met in New York</a>), and the audience page shows a speaker <em>on</em> stage (specifically, <a href="https://nl.wikipedia.org/wiki/Zwarte_Riek">Rika Jansen</a> (page in Dutch), a Dutch singer, mostly because I liked the picture and she looks¬†cool).</p><ol class="simple-footnotes"><li id="sf-remote-applause-1">but it requires javascript! Aren‚Äôt you always going on about that, Stuart? Well, yes. However, it‚Äôs flat-out not possible to do real-time two-way communication sanely without it, so I‚Äôm <span class="caps">OK</span> with requiring <span class="caps">JS</span> in this particular case. For your restaurant menu, no. <a href="#sf-remote-applause-1-back" class="simple-footnote-back">‚Ü©</a></li><li id="sf-remote-applause-2">using a quick <span class="caps">JS</span> version of Java‚Äôs <code>hashCode</code> function, because PeerJS has requirements on <span class="caps">ID</span> strings that exclude some of the characters in base64 so I couldn‚Äôt use <code>window.btoa()</code>, I didn‚Äôt want (or need) a whole hash library, and the <a href="https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto">Web Crypto <span class="caps">API</span></a> is complex <a href="#sf-remote-applause-2-back" class="simple-footnote-back">‚Ü©</a></li></ol>
		</div> <!--/#entry-content-->
		<ul class="neighbours-links">
		<li><a href="https://www.kryogenix.org/days/2020/04/15/a-uk-map-made-of-squares/">Previous post</a></li>
		<li><a href="https://www.kryogenix.org/days/2020/05/06/hammer-and-nails/">Next post</a></li>
		</ul>

		<div class="hireme">
			I'm currently available for hire, to help you plan, architect, and build new systems, and for technical writing
			and articles. You can take a look at <a href="https://kryogenix.org">some projects I've worked on</a> and
			<a href="https://kryogenix.org/books">some of my writing</a>. If you'd like to talk about your upcoming project,
			do <a href="https://kryogenix.org/contact">get in touch.</a>
		</div>
	</div> <!--/#main-->
</div>  <!--/#post-->
<div id="webmentions">
<h4>More in the discussion (powered by <a href="http://indiewebcamp.com/Webmention">webmentions</a>)</h4>
	<ul><li>(no mentions, yet.)</li></ul>
<form id="wmform" method="POST" action="https://webmention.herokuapp.com/api/webmention">
	<label>Did you link to this post? Enter your page's URL:
	<input type="url" name="source"></label>
	<input type="hidden" name="target" value="https://www.kryogenix.org/days/2020/04/27/remote-applause/">
	<input type="submit" value="Add link">
</form>
<script src="https://www.kryogenix.org/days/theme/live-webmentions-cors.js"></script>
</div>

<p id="oldcomments"></p>
<script>
var aurl = '2020/04/27/remote-applause/';
var parts = aurl.split('/');
if (parts[parts.length-1] === "") { parts = parts.slice(0, parts.length-1); }
var tooNewForOldComments = false;
if (parts[0].match(/^[0-9]+$/)) {
	var asnum = parseInt(parts[0], 10);
	if (!isNaN(asnum) && asnum > 2014) {
		tooNewForOldComments = true;
	}
}
if (!tooNewForOldComments) {
	var comurl = "/oldcomments/" + parts.join("-") + ".html";
	var x = new XMLHttpRequest();
	x.open("HEAD", comurl, true);
	x.onreadystatechange = function() {
		if (x.readyState == 4) {
			if (x.status == 200) {
				document.getElementById("oldcomments").innerHTML = '<a href="' + comurl + '">See pre-2014 comments on this post</a>';
			}
		}
	};
	x.send();
}
</script>
<script type="module">
/* jslint esversion: 11 */
try {
	const resp = await fetch("/adpb-popular.json");
	const vals = await resp.json();
	let popular = vals[location.pathname];
	if (!popular && location.pathname.endsWith("/")) {
		popular = vals[location.pathname.replace(/\/$/, "")];
	}
	if (popular && popular.recent_idx != null) {
		let a = document.createElement("a");
		let p = document.createElement("p");
		p.className = "trending";
		a.href = "/adpb-popular.html";
		a.append(`#${popular.recent_idx + 1} in Trending`);
		p.append(a);
		const ec = document.querySelector("div.entry-content");
		ec.insertBefore(p, ec.firstChild);
	}
} catch(e) {
	console.error("Failed to fetch popular list", e);
}
</script>
<script src="https://www.kryogenix.org/days/theme/unrot-redirect.js"></script>

		</div>
		
		<div id="footer">
			<p>Powered by <a href="http://pelican.readthedocs.org">Pelican</a>, theme by <a href="http://bunnyman.info">tBunnyMan</a>.</p>
			<script src="https://the-claw-webring-widget.netlify.app/the-claw-webring-widget.mjs" type="module"></script>
			<the-claw-webring-widget />
			<!-- Global site tag (gtag.js) - Google Analytics. Cookie set to be a session cookie, not permanent, for privacy
			https://developers.google.com/analytics/devguides/collection/gtagjs/cookies-user-id#cookie_expiration -->
			<script async src="https://www.googletagmanager.com/gtag/js?id=UA-331575-1"></script>
			<script>
  				window.dataLayer = window.dataLayer || [];
  				function gtag(){dataLayer.push(arguments);}
  				gtag('js', new Date());
  				gtag('config', 'UA-331575-1', {cookie_expires: 0});
			</script>
		</div><!-- /#footer -->
	</div><!-- /#container -->




<div id="loadtimer"></div>
<script>
window.onload = function(){
    setTimeout(function(){
      window.performance = window.performance || 
window.mozPerformance || window.msPerformance || 
window.webkitPerformance || {};
      var t = performance.timing || {};
      if (!t) {
        
        return;
      }
      var start = t.navigationStart,
          end = t.loadEventEnd
          loadTime = (end - start) / 1000;
      var copy = document.getElementById('loadtimer');
      copy.innerHTML += "This page loaded in " + loadTime + " seconds.";
    }, 0); 
}

</script>
</body> </html>